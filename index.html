<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How To Become A Millionaire - Investment Education</title>
    
    <!-- Material Design Icons and Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        /* MD3 Design Tokens - Updated for education theme */
        :root {
            /* Primary brand color - Money/Investment themed */
            --md-sys-color-primary: #146B3A;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #9CF4B3;
            --md-sys-color-on-primary-container: #00210E;
            
            /* Secondary accent color */
            --md-sys-color-secondary: #4D6356;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #CFE9D9;
            --md-sys-color-on-secondary-container: #0B1F15;
            
            /* Tertiary accent - Used for callouts */
            --md-sys-color-tertiary: #3D6374;
            --md-sys-color-on-tertiary: #FFFFFF;
            --md-sys-color-tertiary-container: #C1E8FC;
            --md-sys-color-on-tertiary-container: #001F2A;
            
            /* Error states */
            --md-sys-color-error: #BA1A1A;
            --md-sys-color-on-error: #FFFFFF;
            --md-sys-color-error-container: #FFDAD6;
            --md-sys-color-on-error-container: #410002;
            
            /* Background and surface colors */
            --md-sys-color-background: #FBFDF8;
            --md-sys-color-on-background: #191C19;
            --md-sys-color-surface: #FBFDF8;
            --md-sys-color-on-surface: #191C19;
            --md-sys-color-surface-variant: #DCE5DB;
            --md-sys-color-on-surface-variant: #404943;
            
            /* Outline color */
            --md-sys-color-outline: #707973;
            
            /* Elevations */
            --md-sys-elevation-1: 0px 1px 2px rgba(0, 0, 0, 0.3),
                                 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
            --md-sys-elevation-2: 0px 1px 2px rgba(0, 0, 0, 0.3),
                                 0px 2px 6px 2px rgba(0, 0, 0, 0.15);
            --md-sys-elevation-3: 0px 1px 3px rgba(0, 0, 0, 0.3),
                                 0px 4px 8px 3px rgba(0, 0, 0, 0.15);
            
            /* Typography scale */
            --md-sys-typescale-display-large: 57px;
            --md-sys-typescale-display-medium: 45px;
            --md-sys-typescale-display-small: 36px;
            --md-sys-typescale-headline-large: 32px;
            --md-sys-typescale-headline-medium: 28px;
            --md-sys-typescale-headline-small: 24px;
            --md-sys-typescale-body-large: 16px;
            --md-sys-typescale-body-medium: 14px;
            --md-sys-typescale-body-small: 12px;
        }

        /* Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--md-sys-color-on-surface);
            background-color: var(--md-sys-color-background);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Side Navigation */
        .nav-rail {
            width: 280px;
            background-color: var(--md-sys-color-surface);
            padding: 24px 16px;
            box-shadow: var(--md-sys-elevation-1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: var(--md-sys-typescale-body-small);
            color: var(--md-sys-color-on-surface-variant);
            padding: 16px 12px 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 4px 0;
            border-radius: 28px;
            color: var(--md-sys-color-on-surface-variant);
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .nav-item:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .nav-item.active {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .nav-item__icon {
            margin-right: 12px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 24px;
        }

        /* Module Cards */
        .module-card {
            background-color: var(--md-sys-color-surface);
            border-radius: 28px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--md-sys-elevation-1);
            transition: box-shadow 0.3s;
        }

        .module-card:hover {
            box-shadow: var(--md-sys-elevation-2);
        }

        .module-card__title {
            font-size: var(--md-sys-typescale-headline-medium);
            color: var(--md-sys-color-on-surface);
            margin-bottom: 16px;
        }

        .module-card__content {
            color: var(--md-sys-color-on-surface-variant);
        }

        /* Educational Sections */
        .education-section {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            padding: 24px;
            border-radius: 24px;
            margin: 24px 0;
        }

        /* Interactive Elements */
        .calculator {
            background-color: var(--md-sys-color-surface-variant);
            padding: 24px;
            border-radius: 24px;
            margin: 24px 0;
        }

        .input-field {
            margin-bottom: 16px;
        }

        .input-field__label {
            display: block;
            color: var(--md-sys-color-on-surface-variant);
            font-size: var(--md-sys-typescale-body-medium);
            margin-bottom: 8px;
        }

        .input-field__input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 12px;
            font-size: var(--md-sys-typescale-body-large);
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .input-field__input:focus {
            outline: none;
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 4px var(--md-sys-color-primary-container);
        }

        /* Buttons */
        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0 24px;
            height: 40px;
            border: none;
            border-radius: 20px;
            font-size: var(--md-sys-typescale-body-large);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .button--primary {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
        }

        .button--primary:hover {
            background-color: var(--md-sys-color-primary);
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Charts and Data Visualization */
        .chart-container {
            background-color: var(--md-sys-color-surface);
            border-radius: 24px;
            padding: 24px;
            margin: 24px 0;
            height: 400px;
            position: relative;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .nav-rail {
                width: 72px;
                padding: 16px 8px;
            }

            .nav-item__label {
                display: none;
            }

            .main-content {
                margin-left: 72px;
            }
        }

        @media (max-width: 600px) {
            .nav-rail {
                bottom: 0;
                width: 100%;
                height: 72px;
                padding: 0;
                display: flex;
                justify-content: space-around;
            }

            .nav-section {
                margin: 0;
            }

            .nav-section-title {
                display: none;
            }

            .main-content {
                margin-left: 0;
                margin-bottom: 72px;
            }

            .module-card {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Navigation Rail -->
        <nav class="nav-rail">
            <div class="nav-section">
                <h2 class="nav-section-title">Fundamentals</h2>
                <a href="#compound-interest" class="nav-item active">
                    <span class="material-symbols-rounded nav-item__icon">trending_up</span>
                    <span class="nav-item__label">Compound Interest</span>
                </a>
                <a href="#rule-of-72" class="nav-item">
                    <span class="material-symbols-rounded nav-item__icon">calculate</span>
                    <span class="nav-item__label">Rule of 72</span>
                </a>
                <a href="#investment-types" class="nav-item">
                    <span class="material-symbols-rounded nav-item__icon">account_balance</span>
                    <span class="nav-item__label">Investment Types</span>
                </a>
            </div>

            <div class="nav-section">
                <h2 class="nav-section-title">Market Understanding</h2>
                <a href="#market-history" class="nav-item">
                    <span class="material-symbols-rounded nav-item__icon">history</span>
                    <span class="nav-item__label">Market History</span>
                </a>
                <a href="#bull-bear" class="nav-item">
                    <span class="material-symbols-rounded nav-item__icon">show_chart</span>
                    <span class="nav-item__label">Bull & Bear Markets</span>
                </a>
            </div>

            <!-- Continue with more navigation sections -->
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <div id="compound-interest" class="module-card">
                <h2 class="module-card__title">The Power of Compound Interest</h2>
                
                <div class="education-section">
                    <blockquote>
                        "Compound interest is the eighth wonder of the world. He who understands it, earns it; he who doesn't, pays it."
                        <footer>- Albert Einstein</footer>
                    </blockquote>
                    
                    <h3>What is Compound Interest?</h3>
                    <p>Compound interest is when you earn interest not just on your initial investment, but also on the interest you've already earned. This creates a snowball effect that can dramatically grow your wealth over time.</p>
                </div>

                <div class="calculator">
                    <h3>Compound Interest Calculator</h3>
                    <!-- Calculator will continue in next section -->

<div class="input-field">
                        <label class="input-field__label" for="principal">Initial Investment ($)</label>
                        <input type="number" id="principal" class="input-field__input" value="5000">
                        <div class="input-hint">Start with the example $5,000 from the presentation</div>
                    </div>
                    
                    <div class="input-field">
                        <label class="input-field__label" for="monthlyContribution">Monthly Contribution ($)</label>
                        <input type="number" id="monthlyContribution" class="input-field__input" value="0">
                    </div>
                    
                    <div class="input-field">
                        <label class="input-field__label" for="years">Investment Timeline (Years)</label>
                        <input type="number" id="years" class="input-field__input" value="48">
                        <div class="input-hint">The presentation example uses 48 years</div>
                    </div>
                    
                    <div class="input-field">
                        <label class="input-field__label" for="rate">Annual Return Rate (%)</label>
                        <input type="number" id="rate" class="input-field__input" value="10" step="0.1">
                        <div class="input-hint">10% is the historical average annual return of the S&P 500</div>
                    </div>

                    <div class="button-group">
                        <button class="button button--primary" onclick="calculateCompound()">
                            <span class="material-symbols-rounded">calculate</span>
                            Calculate Growth
                        </button>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="compoundingChart"></canvas>
                </div>

                <div id="compoundingSummary" class="results-panel">
                    <!-- Results will be populated by JavaScript -->
                </div>
            </div>

            <div id="rule-of-72" class="module-card">
                <h2 class="module-card__title">Rule of 72</h2>
                
                <div class="education-section">
                    <h3>Quick Way to Calculate Investment Doubling Time</h3>
                    <p>The Rule of 72 is a simple way to determine how long an investment will take to double given a fixed annual rate of return.</p>
                    
                    <div class="formula-display">
                        <div class="formula">
                            72 รท Annual Return Rate = Years to Double
                        </div>
                    </div>
                </div>

                <div class="calculator">
                    <h3>Rule of 72 Calculator</h3>
                    <div class="input-field">
                        <label class="input-field__label" for="returnRate">Annual Return Rate (%)</label>
                        <input type="number" id="returnRate" class="input-field__input" value="6" step="0.1">
                    </div>

                    <div class="button-group">
                        <button class="button button--primary" onclick="calculateRule72()">
                            <span class="material-symbols-rounded">timer</span>
                            Calculate Doubling Time
                        </button>
                    </div>

                    <div id="rule72Result" class="results-card">
                        <!-- Results will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div id="investment-types" class="module-card">
                <h2 class="module-card__title">Investment Asset Types</h2>
                
                <div class="asset-grid">
                    <div class="asset-card">
                        <div class="asset-card__icon">
                            <span class="material-symbols-rounded">savings</span>
                        </div>
                        <h3>Savings Account</h3>
                        <ul class="asset-details">
                            <li>Loan to a bank</li>
                            <li>Average Return: 0.01%</li>
                            <li>Time to Double: 7200 years</li>
                            <li>Lowest risk, but also lowest return</li>
                        </ul>
                    </div>

                    <div class="asset-card">
                        <div class="asset-card__icon">
                            <span class="material-symbols-rounded">description</span>
                        </div>
                        <h3>Bonds</h3>
                        <ul class="asset-details">
                            <li>Loan to company/government</li>
                            <li>Average Return: 4%</li>
                            <li>Time to Double: 18 years</li>
                            <li>Medium risk, medium return</li>
                        </ul>
                    </div>

                    <div class="asset-card">
                        <div class="asset-card__icon">
                            <span class="material-symbols-rounded">candlestick_chart</span>
                        </div>
                        <h3>Stocks</h3>
                        <ul class="asset-details">
                            <li>Ownership in companies</li>
                            <li>Average Return: 9%</li>
                            <li>Time to Double: 8 years</li>
                            <li>Higher risk, higher return potential</li>
                        </ul>
                    </div>
                </div>

                <div class="risk-return-chart">
                    <h3>Risk vs Return Comparison</h3>
                    <div class="chart-container">
                        <canvas id="riskReturnChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="market-history" class="module-card">
                <h2 class="module-card__title">Stock Market History</h2>
                
                <div class="education-section">
                    <h3>Dow Jones Industrial Average (1790-2018)</h3>
                    <p>Key takeaway: Despite major events and crashes, the market has shown consistent long-term growth.</p>
                </div>

                <div class="chart-container">
                    <canvas id="marketHistoryChart"></canvas>
                </div>

                <div class="historical-events">
                    <h3>Major Market Events</h3>
                    <div class="timeline">
                        <div class="timeline-event">
                            <div class="event-date">1929</div>
                            <div class="event-description">
                                <h4>Stock Market Crash</h4>
                                <p>Worst crash in history, but market recovered over time</p>
                            </div>
                        </div>
                        <!-- Add more historical events -->
                    </div>
                </div>
            </div>

            <!-- Additional CSS for new components -->
            <style>
                .asset-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 24px;
                    margin: 24px 0;
                }

                .asset-card {
                    background: var(--md-sys-color-surface);
                    border-radius: 24px;
                    padding: 24px;
                    box-shadow: var(--md-sys-elevation-1);
                    transition: all 0.3s;
                }

                .asset-card:hover {
                    box-shadow: var(--md-sys-elevation-2);
                    transform: translateY(-2px);
                }

                .asset-card__icon {
                    font-size: 48px;
                    color: var(--md-sys-color-primary);
                    margin-bottom: 16px;
                }

                .formula-display {
                    background: var(--md-sys-color-secondary-container);
                    padding: 24px;
                    border-radius: 16px;
                    margin: 24px 0;
                    text-align: center;
                }

                .formula {
                    font-size: 24px;
                    font-weight: 500;
                    color: var(--md-sys-color-on-secondary-container);
                }

                .timeline {
                    position: relative;
                    padding: 24px 0;
                }

                .timeline::before {
                    content: '';
                    position: absolute;
                    left: 50%;
                    width: 2px;
                    height: 100%;
                    background: var(--md-sys-color-outline);
                }

                .timeline-event {
                    display: flex;
                    align-items: center;
                    margin: 24px 0;
                }

                .event-date {
                    flex: 1;
                    text-align: right;
                    padding-right: 24px;
                    font-weight: 500;
                }

                .event-description {
                    flex: 1;
                    padding-left: 24px;
                }

                .results-panel {
                    background: var(--md-sys-color-surface);
                    border-radius: 24px;
                    padding: 24px;
                    margin-top: 24px;
                    box-shadow: var(--md-sys-elevation-1);
                }

                .input-hint {
                    font-size: var(--md-sys-typescale-body-small);
                    color: var(--md-sys-color-on-surface-variant);
                    margin-top: 4px;
                }

                .results-card {
                    background: var(--md-sys-color-primary-container);
                    color: var(--md-sys-color-on-primary-container);
                    padding: 24px;
                    border-radius: 16px;
                    margin-top: 24px;
                    text-align: center;
                }
            </style>
<div id="bull-bear" class="module-card">
                <h2 class="module-card__title">Bull & Bear Markets</h2>
                
                <div class="market-types-grid">
                    <div class="market-type bull">
                        <div class="market-type__icon">
                            <span class="material-symbols-rounded">trending_up</span>
                        </div>
                        <h3>Bull Market</h3>
                        <ul>
                            <li>Market is rising or expected to rise</li>
                            <li>Generally indicates economic strength</li>
                            <li>Investor confidence is high</li>
                            <li>Typically lasts 3-4 years on average</li>
                        </ul>
                    </div>

                    <div class="market-type bear">
                        <div class="market-type__icon">
                            <span class="material-symbols-rounded">trending_down</span>
                        </div>
                        <h3>Bear Market</h3>
                        <ul>
                            <li>Market has fallen 20% or more</li>
                            <li>Often indicates economic weakness</li>
                            <li>Investor sentiment is negative</li>
                            <li>Typically lasts 9-10 months on average</li>
                        </ul>
                    </div>
                </div>

                <div class="market-simulator">
                    <h3>Market Cycle Simulator</h3>
                    <div class="simulator-controls">
                        <button class="button button--primary" onclick="startMarketSimulation()">
                            <span class="material-symbols-rounded">play_arrow</span>
                            Simulate Market Cycles
                        </button>
                    </div>
                    <div class="chart-container">
                        <canvas id="marketCyclesChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="ben-arthur" class="module-card">
                <h2 class="module-card__title">The Power of Early Investment: Ben & Arthur</h2>
                
                <div class="comparison-grid">
                    <div class="investor-profile ben">
                        <div class="investor-profile__header">
                            <span class="material-symbols-rounded">person</span>
                            <h3>Ben's Strategy</h3>
                        </div>
                        <ul>
                            <li>Started investing at age 19</li>
                            <li>Invested $2,000 per year</li>
                            <li>Invested for 8 years only</li>
                            <li>Total invested: $16,000</li>
                            <li>12% annual return</li>
                        </ul>
                    </div>

                    <div class="investor-profile arthur">
                        <div class="investor-profile__header">
                            <span class="material-symbols-rounded">person</span>
                            <h3>Arthur's Strategy</h3>
                        </div>
                        <ul>
                            <li>Started investing at age 27</li>
                            <li>Invested $2,000 per year</li>
                            <li>Invested until age 65</li>
                            <li>Total invested: $78,000</li>
                            <li>12% annual return</li>
                        </ul>
                    </div>
                </div>

                <div class="calculator">
                    <h3>Investment Comparison Calculator</h3>
                    <div class="input-field">
                        <label class="input-field__label" for="investmentAmount">Annual Investment ($)</label>
                        <input type="number" id="investmentAmount" class="input-field__input" value="2000">
                    </div>
                    <div class="input-field">
                        <label class="input-field__label" for="returnRate">Annual Return Rate (%)</label>
                        <input type="number" id="returnRate" class="input-field__input" value="12">
                    </div>
                    <button class="button button--primary" onclick="compareBenArthur()">
                        <span class="material-symbols-rounded">compare_arrows</span>
                        Compare Results
                    </button>
                </div>

                <div class="chart-container">
                    <canvas id="benArthurChart"></canvas>
                </div>

                <div class="key-takeaway">
                    <h3>Key Takeaway</h3>
                    <p>Starting early with a smaller total investment ($16,000) can outperform a larger total investment ($78,000) started later, due to the power of compound interest over time.</p>
                </div>
            </div>

            <div id="mutual-funds" class="module-card">
                <h2 class="module-card__title">Understanding Mutual Funds</h2>

                <div class="benefits-grid">
                    <div class="benefit-card">
                        <span class="material-symbols-rounded">group</span>
                        <h3>Professional Management</h3>
                        <p>Experienced portfolio managers make investment decisions</p>
                    </div>

                    <div class="benefit-card">
                        <span class="material-symbols-rounded">diversity_3</span>
                        <h3>Diversification</h3>
                        <p>Spread risk across many different investments</p>
                    </div>

                    <div class="benefit-card">
                        <span class="material-symbols-rounded">target</span>
                        <h3>Investment Objectives</h3>
                        <p>Choose funds that match your goals</p>
                    </div>
                </div>

                <div class="fund-evaluation">
                    <h3>Mutual Fund Evaluation Tool</h3>
                    <div class="evaluation-form">
                        <div class="input-field">
                            <label class="input-field__label" for="fundTicker">Fund Ticker Symbol</label>
                            <input type="text" id="fundTicker" class="input-field__input" placeholder="e.g., VFIAX">
                        </div>

                        <div class="evaluation-metrics">
                            <div class="metric-group">
                                <h4>Returns</h4>
                                <div class="input-field">
                                    <label>1-Year Return (%)</label>
                                    <input type="number" step="0.01" class="input-field__input">
                                </div>
                                <div class="input-field">
                                    <label>3-Year Return (%)</label>
                                    <input type="number" step="0.01" class="input-field__input">
                                </div>
                                <div class="input-field">
                                    <label>5-Year Return (%)</label>
                                    <input type="number" step="0.01" class="input-field__input">
                                </div>
                            </div>

                            <div class="metric-group">
                                <h4>Risk & Ratings</h4>
                                <div class="input-field">
                                    <label>Morningstar Rating (1-5)</label>
                                    <input type="number" min="1" max="5" class="input-field__input">
                                </div>
                                <div class="input-field">
                                    <label>Standard Deviation</label>
                                    <input type="number" step="0.01" class="input-field__input">
                                </div>
                            </div>

                            <div class="metric-group">
                                <h4>Expenses</h4>
                                <div class="input-field">
                                    <label>Expense Ratio (%)</label>
                                    <input type="number" step="0.01" class="input-field__input">
                                </div>
                                <div class="input-field">
                                    <label>Load Fee (%)</label>
                                    <input type="number" step="0.01" class="input-field__input">
                                </div>
                            </div>
                        </div>

                        <button class="button button--primary" onclick="evaluateFund()">
                            <span class="material-symbols-rounded">analytics</span>
                            Evaluate Fund
                        </button>
                    </div>

                    <div id="fundEvaluationResult" class="evaluation-result">
                        <!-- Results will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Additional styles for new components -->
                <style>
                    .market-types-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 24px;
                        margin: 24px 0;
                    }

                    .market-type {
                        background: var(--md-sys-color-surface);
                        border-radius: 24px;
                        padding: 24px;
                        box-shadow: var(--md-sys-elevation-1);
                    }

                    .market-type.bull {
                        border-left: 4px solid #4CAF50;
                    }

                    .market-type.bear {
                        border-left: 4px solid #F44336;
                    }

                    .comparison-grid {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 24px;
                        margin: 24px 0;
                    }

                    .investor-profile {
                        background: var(--md-sys-color-surface);
                        border-radius: 24px;
                        padding: 24px;
                        box-shadow: var(--md-sys-elevation-1);
                    }

                    .investor-profile__header {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                        margin-bottom: 16px;
                    }

                    .benefits-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                        gap: 24px;
                        margin: 24px 0;
                    }

                    .benefit-card {
                        background: var(--md-sys-color-surface);
                        border-radius: 24px;
                        padding: 24px;
                        text-align: center;
                        box-shadow: var(--md-sys-elevation-1);
                    }

                    .benefit-card .material-symbols-rounded {
                        font-size: 48px;
                        color: var(--md-sys-color-primary);
                        margin-bottom: 16px;
                    }

                    .evaluation-metrics {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 24px;
                        margin: 24px 0;
                    }

                    .metric-group {
                        background: var(--md-sys-color-surface-variant);
                        padding: 16px;
                        border-radius: 16px;
                    }

                    .evaluation-result {
                        margin-top: 24px;
                        padding: 24px;
                        background: var(--md-sys-color-surface);
                        border-radius: 24px;
                        box-shadow: var(--md-sys-elevation-1);
                    }

                    @media (max-width: 768px) {
                        .market-types-grid,
                        .comparison-grid {
                            grid-template-columns: 1fr;
                        }
                    }
                </style>
<div id="market-cap" class="module-card">
                <h2 class="module-card__title">Market Capitalizations</h2>
                
                <div class="market-cap-grid">
                    <div class="market-cap-card mega">
                        <h3>Mega-Cap</h3>
                        <div class="cap-value">$100B+</div>
                        <div class="example-companies">
                            <h4>Examples:</h4>
                            <ul>
                                <li>Apple</li>
                                <li>Microsoft</li>
                                <li>Amazon</li>
                            </ul>
                        </div>
                    </div>

                    <div class="market-cap-card large">
                        <h3>Large-Cap</h3>
                        <div class="cap-value">$8B - $100B</div>
                        <div class="example-companies">
                            <h4>Examples:</h4>
                            <ul>
                                <li>Starbucks</li>
                                <li>FedEx</li>
                                <li>Target</li>
                            </ul>
                        </div>
                    </div>

                    <div class="market-cap-card mid">
                        <h3>Mid-Cap</h3>
                        <div class="cap-value">$1B - $8B</div>
                        <div class="example-companies">
                            <h4>Examples:</h4>
                            <ul>
                                <li>Crocs</li>
                                <li>Mattel</li>
                                <li>Wendy's</li>
                            </ul>
                        </div>
                    </div>

                    <div class="market-cap-card small">
                        <h3>Small-Cap</h3>
                        <div class="cap-value">$300M - $1B</div>
                        <div class="example-companies">
                            <h4>Examples:</h4>
                            <ul>
                                <li>Build-A-Bear Workshop</li>
                                <li>Groupon</li>
                                <li>Express</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="market-cap-visualization">
                    <h3>Market Cap Distribution Visualization</h3>
                    <div class="chart-container">
                        <canvas id="marketCapChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="common-mistakes" class="module-card">
                <h2 class="module-card__title">Three Common Investment Mistakes</h2>

                <div class="mistakes-container">
                    <div class="mistake-card expenses">
                        <div class="mistake-header">
                            <span class="material-symbols-rounded">money_off</span>
                            <h3>Not Watching Expenses</h3>
                        </div>
                        <div class="mistake-content">
                            <h4>What to Watch:</h4>
                            <ul>
                                <li>Load fees (Avoid funds with loads)</li>
                                <li>Expense ratios (Keep under 1%)</li>
                                <li>Transaction costs</li>
                                <li>Advisory fees</li>
                            </ul>
                            <div class="expense-calculator">
                                <h4>Impact of Expenses Calculator</h4>
                                <div class="input-field">
                                    <label>Investment Amount ($)</label>
                                    <input type="number" id="expenseAmount" value="100000">
                                </div>
                                <div class="input-field">
                                    <label>Years Invested</label>
                                    <input type="number" id="expenseYears" value="30">
                                </div>
                                <div class="input-field">
                                    <label>Annual Return (%)</label>
                                    <input type="number" id="expenseReturn" value="7">
                                </div>
                                <div class="input-field">
                                    <label>Expense Ratio (%)</label>
                                    <input type="number" id="expenseRatio" value="1" step="0.1">
                                </div>
                                <button class="button button--primary" onclick="calculateExpenseImpact()">
                                    Calculate Impact
                                </button>
                                <div id="expenseResult" class="calculator-result"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mistake-card timing">
                        <div class="mistake-header">
                            <span class="material-symbols-rounded">schedule</span>
                            <h3>Market Timing</h3>
                        </div>
                        <div class="mistake-content">
                            <h4>Why It's a Mistake:</h4>
                            <ul>
                                <li>Missing best market days drastically reduces returns</li>
                                <li>Emotions lead to buying high and selling low</li>
                                <li>Even professionals can't consistently time the market</li>
                            </ul>
                            <div class="timing-simulator">
                                <h4>Market Timing Impact Simulator</h4>
                                <div class="input-field">
                                    <label>Initial Investment ($)</label>
                                    <input type="number" id="timingAmount" value="10000">
                                </div>
                                <div class="input-field">
                                    <label>Number of Best Days Missed</label>
                                    <select id="missedDays">
                                        <option value="5">5 Best Days</option>
                                        <option value="10">10 Best Days</option>
                                        <option value="20">20 Best Days</option>
                                    </select>
                                </div>
                                <button class="button button--primary" onclick="simulateMarketTiming()">
                                    Show Impact
                                </button>
                                <div id="timingResult" class="calculator-result"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mistake-card diversification">
                        <div class="mistake-header">
                            <span class="material-symbols-rounded">egg_alt</span>
                            <h3>Poor Diversification</h3>
                        </div>
                        <div class="mistake-content">
                            <h4>Common Pitfalls:</h4>
                            <ul>
                                <li>Too much in single stocks</li>
                                <li>Over-concentration in one sector</li>
                                <li>Home country bias</li>
                                <li>Ignoring other asset classes</li>
                            </ul>
                            <div class="diversification-tool">
                                <h4>Portfolio Diversification Analyzer</h4>
                                <div class="portfolio-input">
                                    <!-- Dynamic portfolio input fields will be added here -->
                                </div>
                                <button class="button button--secondary" onclick="addHolding()">
                                    Add Holding
                                </button>
                                <button class="button button--primary" onclick="analyzeDiversification()">
                                    Analyze Portfolio
                                </button>
                                <div id="diversificationResult" class="calculator-result"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add JavaScript for interactive features -->
            <script>
                // Compound Interest Calculator
                function calculateCompound() {
                    const principal = parseFloat(document.getElementById('principal').value);
                    const monthlyContribution = parseFloat(document.getElementById('monthlyContribution').value);
                    const years = parseInt(document.getElementById('years').value);
                    const rate = parseFloat(document.getElementById('rate').value) / 100;

                    let data = {
                        labels: [],
                        datasets: [{
                            label: 'Portfolio Value',
                            data: [],
                            borderColor: 'rgb(20, 107, 58)',
                            backgroundColor: 'rgba(20, 107, 58, 0.1)',
                            fill: true
                        }]
                    };

                    let balance = principal;
                    for (let year = 0; year <= years; year++) {
                        data.labels.push(`Year ${year}`);
                        data.datasets[0].data.push(balance);
                        balance = balance * (1 + rate) + (monthlyContribution * 12);
                    }

                    const ctx = document.getElementById('compoundingChart').getContext('2d');
                    if (window.compoundingChart) {
                        window.compoundingChart.destroy();
                    }

                    window.compoundingChart = new Chart(ctx, {
                        type: 'line',
                        data: data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `$${context.raw.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    ticks: {
                                        callback: function(value) {
                                            return `$${value.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Update summary
                    const finalBalance = data.datasets[0].data[years];
                    const totalContributed = principal + (monthlyContribution * 12 * years);
                    const earnings = finalBalance - totalContributed;

                    document.getElementById('compoundingSummary').innerHTML = `
                        <div class="summary-grid">
                            <div class="summary-item">
                                <h4>Final Balance</h4>
                                <p>$${finalBalance.toLocaleString('en-US')}</p>
                            </div>
                            <div class="summary-item">
                                <h4>Total Contributed</h4>
                                <p>$${totalContributed.toLocaleString('en-US')}</p>
                            </div>
                            <div class="summary-item">
                                <h4>Total Earnings</h4>
                                <p>$${earnings.toLocaleString('en-US')}</p>
                            </div>
                            <div class="summary-item">
                                <h4>Return on Investment</h4>
                                <p>${((earnings/totalContributed) * 100).toFixed(1)}%</p>
                            </div>
                        </div>
                    `;
                }
// Rule of 72 Calculator
                function calculateRule72() {
                    const rate = parseFloat(document.getElementById('returnRate').value);
                    const yearsToDouble = 72 / rate;
                    
                    document.getElementById('rule72Result').innerHTML = `
                        <div class="result-highlight">
                            <h4>At ${rate}% annual return:</h4>
                            <p class="large-number">${yearsToDouble.toFixed(1)} years</p>
                            <p class="explanation">to double your money</p>
                        </div>
                        <div class="example">
                            <p>Example: $10,000 becomes $20,000 in ${yearsToDouble.toFixed(1)} years</p>
                        </div>
                    `;
                }

                // Ben & Arthur Comparison Calculator
                function compareBenArthur() {
                    const annualInvestment = parseFloat(document.getElementById('investmentAmount').value);
                    const returnRate = parseFloat(document.getElementById('returnRate').value) / 100;
                    
                    // Ben's investment (8 years, starting at 19)
                    let benData = calculateInvestmentGrowth(annualInvestment, 8, returnRate, 38);
                    
                    // Arthur's investment (39 years, starting at 27)
                    let arthurData = calculateInvestmentGrowth(annualInvestment, 39, returnRate, 0);
                    
                    const ctx = document.getElementById('benArthurChart').getContext('2d');
                    if (window.benArthurChart) {
                        window.benArthurChart.destroy();
                    }

                    window.benArthurChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({length: 47}, (_, i) => `Age ${i + 19}`),
                            datasets: [
                                {
                                    label: 'Ben',
                                    data: benData,
                                    borderColor: 'rgb(20, 107, 58)',
                                    backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                    fill: true
                                },
                                {
                                    label: 'Arthur',
                                    data: arthurData,
                                    borderColor: 'rgb(77, 99, 86)',
                                    backgroundColor: 'rgba(77, 99, 86, 0.1)',
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: $${context.raw.toLocaleString('en-US')}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    ticks: {
                                        callback: function(value) {
                                            return `$${value.toLocaleString('en-US')}`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Display final results
                    const benFinal = benData[benData.length - 1];
                    const arthurFinal = arthurData[arthurData.length - 1];
                    const benTotal = annualInvestment * 8;
                    const arthurTotal = annualInvestment * 39;

                    document.getElementById('comparisonResults').innerHTML = `
                        <div class="results-grid">
                            <div class="result-card ben">
                                <h4>Ben's Results</h4>
                                <div class="result-details">
                                    <p>Total Invested: $${benTotal.toLocaleString('en-US')}</p>
                                    <p>Final Value: $${benFinal.toLocaleString('en-US')}</p>
                                    <p>Return: ${((benFinal/benTotal - 1) * 100).toFixed(1)}%</p>
                                </div>
                            </div>
                            <div class="result-card arthur">
                                <h4>Arthur's Results</h4>
                                <div class="result-details">
                                    <p>Total Invested: $${arthurTotal.toLocaleString('en-US')}</p>
                                    <p>Final Value: $${arthurFinal.toLocaleString('en-US')}</p>
                                    <p>Return: ${((arthurFinal/arthurTotal - 1) * 100).toFixed(1)}%</p>
                                </div>
                            </div>
                        </div>
                    `;
                }

                // Helper function for Ben & Arthur calculation
                function calculateInvestmentGrowth(annualInvestment, investmentYears, returnRate, delayYears) {
                    let values = Array(47).fill(0);
                    let balance = 0;
                    
                    // Add investments for the specified years
                    for (let i = 0; i < 47; i++) {
                        if (i >= delayYears && i < delayYears + investmentYears) {
                            balance += annualInvestment;
                        }
                        balance *= (1 + returnRate);
                        values[i] = balance;
                    }
                    
                    return values;
                }

                // Market Timing Impact Calculator
                function simulateMarketTiming() {
                    const investment = parseFloat(document.getElementById('timingAmount').value);
                    const missedDays = parseInt(document.getElementById('missedDays').value);
                    
                    // Based on historical data of missing best market days
                    const impactRates = {
                        5: 0.35,  // Missing 5 best days reduces returns by 35%
                        10: 0.50, // Missing 10 best days reduces returns by 50%
                        20: 0.63  // Missing 20 best days reduces returns by 63%
                    };

                    const fullReturn = investment * 2.5; // Assumed market return over 20 years
                    const reducedReturn = investment * (2.5 * (1 - impactRates[missedDays]));

                    const ctx = document.getElementById('timingImpactChart').getContext('2d');
                    if (window.timingChart) {
                        window.timingChart.destroy();
                    }

                    window.timingChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Fully Invested', `Missed ${missedDays} Best Days`],
                            datasets: [{
                                data: [fullReturn, reducedReturn],
                                backgroundColor: [
                                    'rgba(20, 107, 58, 0.6)',
                                    'rgba(186, 26, 26, 0.6)'
                                ],
                                borderColor: [
                                    'rgb(20, 107, 58)',
                                    'rgb(186, 26, 26)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `$${context.raw.toLocaleString('en-US')}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return `$${value.toLocaleString('en-US')}`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Display impact summary
                    document.getElementById('timingResult').innerHTML = `
                        <div class="impact-summary">
                            <h4>Impact of Missing Best Days</h4>
                            <p>Lost Opportunity: $${(fullReturn - reducedReturn).toLocaleString('en-US')}</p>
                            <p>Percentage Loss: ${(impactRates[missedDays] * 100).toFixed(1)}%</p>
                            <div class="impact-note">
                                <p>Historical data shows that missing just a few of the market's best days can significantly reduce long-term returns.</p>
                            </div>
                        </div>
                    `;
                }

                // Fund Evaluation Tool
                function evaluateFund() {
                    const ticker = document.getElementById('fundTicker').value.toUpperCase();
                    const expenseRatio = parseFloat(document.getElementById('expenseRatio').value) || 0;
                    const returns = {
                        oneYear: parseFloat(document.getElementById('oneYearReturn').value) || 0,
                        threeYear: parseFloat(document.getElementById('threeYearReturn').value) || 0,
                        fiveYear: parseFloat(document.getElementById('fiveYearReturn').value) || 0
                    };
                    const rating = parseInt(document.getElementById('morningstarRating').value) || 0;
                    
                    let score = 0;
                    let concerns = [];
                    let positives = [];

                    // Evaluate expense ratio
                    if (expenseRatio > 1) {
                        concerns.push("High expense ratio");
                        score -= 2;
                    } else if (expenseRatio < 0.5) {
                        positives.push("Low expense ratio");
                        score += 2;
                    }

                    // Evaluate returns
                    if (returns.fiveYear > 10) {
                        positives.push("Strong 5-year performance");
                        score += 2;
                    } else if (returns.fiveYear < 5) {
                        concerns.push("Weak 5-year performance");
                        score -= 2;
                    }

                    // Evaluate Morningstar rating
                    if (rating >= 4) {
                        positives.push("High Morningstar rating");
                        score += 2;
                    } else if (rating <= 2) {
                        concerns.push("Low Morningstar rating");
                        score -= 2;
                    }

                    // Generate recommendation
                    let recommendation = "";
                    if (score >= 4) {
                        recommendation = "Strong Consider";
                    } else if (score >= 0) {
                        recommendation = "Further Research Needed";
                    } else {
                        recommendation = "Exercise Caution";
                    }

                    // Display evaluation results
                    document.getElementById('fundEvaluationResult').innerHTML = `
                        <div class="evaluation-summary">
                            <h3>Evaluation Results for ${ticker}</h3>
                            <div class="recommendation ${recommendation.toLowerCase().replace(' ', '-')}">
                                <h4>Recommendation: ${recommendation}</h4>
                            </div>
                            <div class="evaluation-details">
                                <div class="positives">
                                    <h4>Strengths</h4>
                                    <ul>
                                        ${positives.map(p => `<li>${p}</li>`).join('')}
                                    </ul>
                                </div>
                                <div class="concerns">
                                    <h4>Concerns</h4>
                                    <ul>
                                        ${concerns.map(c => `<li>${c}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    `;
                }
// Market Cap Visualization
                function initializeMarketCapChart() {
                    const ctx = document.getElementById('marketCapChart').getContext('2d');
                    if (window.marketCapChart) {
                        window.marketCapChart.destroy();
                    }

                    const data = {
                        labels: ['Mega-Cap', 'Large-Cap', 'Mid-Cap', 'Small-Cap', 'Micro-Cap'],
                        datasets: [{
                            data: [45, 30, 15, 7, 3], // Approximate market representation percentages
                            backgroundColor: [
                                'rgba(20, 107, 58, 0.8)',
                                'rgba(46, 125, 50, 0.8)',
                                'rgba(56, 142, 60, 0.8)',
                                'rgba(67, 160, 71, 0.8)',
                                'rgba(76, 175, 80, 0.8)'
                            ]
                        }]
                    };

                    window.marketCapChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.label}: ${context.raw}% of market`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                // Portfolio Rebalancing Tool
                function initializeRebalancing() {
                    const currentAllocation = {
                        stocks: 70,
                        bonds: 20,
                        cash: 10
                    };

                    const targetAllocation = {
                        stocks: 60,
                        bonds: 30,
                        cash: 10
                    };

                    const ctx = document.getElementById('rebalancingChart').getContext('2d');
                    if (window.rebalancingChart) {
                        window.rebalancingChart.destroy();
                    }

                    window.rebalancingChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Stocks', 'Bonds', 'Cash'],
                            datasets: [{
                                label: 'Current Allocation',
                                data: [
                                    currentAllocation.stocks,
                                    currentAllocation.bonds,
                                    currentAllocation.cash
                                ],
                                backgroundColor: 'rgba(20, 107, 58, 0.6)'
                            }, {
                                label: 'Target Allocation',
                                data: [
                                    targetAllocation.stocks,
                                    targetAllocation.bonds,
                                    targetAllocation.cash
                                ],
                                backgroundColor: 'rgba(77, 99, 86, 0.6)'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        callback: function(value) {
                                            return value + '%';
                                        }
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${context.raw}%`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }

                // Expense Impact Calculator
                function calculateExpenseImpact() {
                    const amount = parseFloat(document.getElementById('expenseAmount').value);
                    const years = parseInt(document.getElementById('expenseYears').value);
                    const return_rate = parseFloat(document.getElementById('expenseReturn').value) / 100;
                    const expense_ratio = parseFloat(document.getElementById('expenseRatio').value) / 100;

                    // Calculate growth with and without expenses
                    const withoutExpenses = amount * Math.pow(1 + return_rate, years);
                    const withExpenses = amount * Math.pow(1 + (return_rate - expense_ratio), years);
                    const expenseImpact = withoutExpenses - withExpenses;

                    const ctx = document.getElementById('expenseImpactChart').getContext('2d');
                    if (window.expenseChart) {
                        window.expenseChart.destroy();
                    }

                    // Create expense impact visualization
                    window.expenseChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Without Expenses', 'With Expenses', 'Lost to Expenses'],
                            datasets: [{
                                data: [withoutExpenses, withExpenses, expenseImpact],
                                backgroundColor: [
                                    'rgba(20, 107, 58, 0.6)',
                                    'rgba(77, 99, 86, 0.6)',
                                    'rgba(186, 26, 26, 0.6)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `$${context.raw.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Display summary results
                    document.getElementById('expenseResult').innerHTML = `
                        <div class="expense-impact-summary">
                            <div class="impact-detail">
                                <h4>Portfolio Value Without Expenses</h4>
                                <p class="value">$${withoutExpenses.toLocaleString('en-US', {
                                    minimumFractionDigits: 0,
                                    maximumFractionDigits: 0
                                })}</p>
                            </div>
                            <div class="impact-detail">
                                <h4>Portfolio Value With Expenses</h4>
                                <p class="value">$${withExpenses.toLocaleString('en-US', {
                                    minimumFractionDigits: 0,
                                    maximumFractionDigits: 0
                                })}</p>
                            </div>
                            <div class="impact-detail negative">
                                <h4>Total Cost of Expenses</h4>
                                <p class="value">$${expenseImpact.toLocaleString('en-US', {
                                    minimumFractionDigits: 0,
                                    maximumFractionDigits: 0
                                })}</p>
                            </div>
                            <div class="impact-detail">
                                <h4>Percentage Lost to Expenses</h4>
                                <p class="value">${((expenseImpact / withoutExpenses) * 100).toFixed(1)}%</p>
                            </div>
                        </div>
                        <div class="expense-recommendation">
                            ${getExpenseRecommendation(expense_ratio)}
                        </div>
                    `;
                }

                // Helper function for expense recommendations
                function getExpenseRecommendation(expense_ratio) {
                    if (expense_ratio <= 0.0020) {
                        return `
                            <div class="recommendation good">
                                <h4>Excellent Expense Ratio</h4>
                                <p>This is a very competitive expense ratio, typical of low-cost index funds.</p>
                            </div>
                        `;
                    } else if (expense_ratio <= 0.0050) {
                        return `
                            <div class="recommendation moderate">
                                <h4>Reasonable Expense Ratio</h4>
                                <p>This expense ratio is reasonable but consider if there are lower-cost alternatives available.</p>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="recommendation warning">
                                <h4>High Expense Ratio</h4>
                                <p>Consider looking for lower-cost alternatives. Many index funds offer similar exposure with lower expenses.</p>
                            </div>
                        `;
                    }
                }

                // Initialize all visualizations on page load
                document.addEventListener('DOMContentLoaded', function() {
                    // Initialize default module
                    showModule('compound-interest');
                    
                    // Initialize all charts
                    calculateCompound();
                    initializeMarketCapChart();
                    initializeRebalancing();
                    
                    // Add input validation
                    document.querySelectorAll('input[type="number"]').forEach(input => {
                        input.addEventListener('input', function() {
                            validateInput(this);
                        });
                    });
                });

                // Input validation helper
                function validateInput(input) {
                    let value = parseFloat(input.value);
                    if (isNaN(value)) {
                        value = 0;
                    }
                    
                    // Apply specific validation rules based on input type
                    if (input.id.includes('percentage') || input.id.includes('rate')) {
                        value = Math.min(100, Math.max(0, value));
                    } else if (input.id.includes('Amount')) {
                        value = Math.max(0, value);
                    }
                    
                    input.value = value;
                    return value;
                }
// Quiz System
                const quizQuestions = {
                    compounding: [
                        {
                            question: "Using the Rule of 72, approximately how long will it take to double your money at 9% annual returns?",
                            options: ["6 years", "8 years", "10 years", "12 years"],
                            correct: 1,
                            explanation: "72 รท 9 = 8 years. The Rule of 72 provides a quick way to estimate doubling time."
                        },
                        {
                            question: "If Ben invests $2,000 annually for 8 years starting at age 19, and Arthur invests $2,000 annually for 39 years starting at age 27, who will have more money at age 65 (assuming 12% returns)?",
                            options: ["Ben", "Arthur", "They'll have the same amount", "Not enough information"],
                            correct: 0,
                            explanation: "Ben will have more money due to compound interest working for a longer period on his early investments."
                        }
                    ],
                    markets: [
                        {
                            question: "What defines a bear market?",
                            options: [
                                "A 10% decline from recent highs",
                                "A 20% decline from recent highs",
                                "A 30% decline from recent highs",
                                "Any market decline"
                            ],
                            correct: 1,
                            explanation: "A bear market is defined as a 20% or greater decline from recent market highs."
                        },
                        {
                            question: "Which market cap category typically includes companies valued between $1-8 billion?",
                            options: ["Mega-cap", "Large-cap", "Mid-cap", "Small-cap"],
                            correct: 2,
                            explanation: "Mid-cap companies typically have market capitalizations between $1-8 billion."
                        }
                    ],
                    fundEvaluation: [
                        {
                            question: "What is considered a high expense ratio for an index fund?",
                            options: ["0.03%", "0.25%", "0.50%", "Above 0.75%"],
                            correct: 3,
                            explanation: "Index funds should typically have expense ratios below 0.20%. Anything above 0.75% is considered high."
                        },
                        {
                            question: "What does a 5-star Morningstar rating indicate?",
                            options: [
                                "Guaranteed future performance",
                                "Top historical risk-adjusted returns",
                                "Lowest expenses",
                                "Highest total return"
                            ],
                            correct: 1,
                            explanation: "Morningstar's star rating indicates strong historical risk-adjusted returns relative to peers, but doesn't guarantee future performance."
                        }
                    ]
                };

                let currentQuiz = null;
                let currentQuestion = 0;
                let score = 0;

                function startQuiz(category) {
                    currentQuiz = category;
                    currentQuestion = 0;
                    score = 0;
                    displayQuestion();
                }

                function displayQuestion() {
                    const quiz = quizQuestions[currentQuiz];
                    const question = quiz[currentQuestion];
                    const quizContainer = document.getElementById('quizContainer');

                    quizContainer.innerHTML = `
                        <div class="quiz-progress">
                            Question ${currentQuestion + 1} of ${quiz.length}
                        </div>
                        <div class="quiz-question">
                            <h4>${question.question}</h4>
                            <div class="quiz-options">
                                ${question.options.map((option, index) => `
                                    <button 
                                        class="quiz-option" 
                                        onclick="checkAnswer(${index})"
                                        ${document.querySelector('.quiz-result') ? 'disabled' : ''}
                                    >
                                        ${option}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                function checkAnswer(selectedIndex) {
                    const question = quizQuestions[currentQuiz][currentQuestion];
                    const quizContainer = document.getElementById('quizContainer');
                    const options = quizContainer.querySelectorAll('.quiz-option');

                    // Disable all options
                    options.forEach(option => option.disabled = true);

                    // Mark correct and incorrect answers
                    options[question.correct].classList.add('correct');
                    if (selectedIndex !== question.correct) {
                        options[selectedIndex].classList.add('incorrect');
                    } else {
                        score++;
                    }

                    // Show explanation
                    quizContainer.innerHTML += `
                        <div class="quiz-explanation">
                            <p>${selectedIndex === question.correct ? 'โ Correct!' : 'โ Incorrect'}</p>
                            <p>${question.explanation}</p>
                            <button class="button button--primary" onclick="nextQuestion()">
                                ${currentQuestion === quizQuestions[currentQuiz].length - 1 ? 'See Results' : 'Next Question'}
                            </button>
                        </div>
                    `;
                }

                function nextQuestion() {
                    currentQuestion++;
                    if (currentQuestion < quizQuestions[currentQuiz].length) {
                        displayQuestion();
                    } else {
                        showQuizResults();
                    }
                }

                function showQuizResults() {
                    const totalQuestions = quizQuestions[currentQuiz].length;
                    const percentage = (score / totalQuestions) * 100;
                    const quizContainer = document.getElementById('quizContainer');

                    quizContainer.innerHTML = `
                        <div class="quiz-results">
                            <h3>Quiz Complete!</h3>
                            <div class="score-circle">
                                <div class="score-number">${percentage}%</div>
                                <div class="score-text">Score</div>
                            </div>
                            <p>You got ${score} out of ${totalQuestions} questions correct.</p>
                            <div class="quiz-feedback">
                                ${getQuizFeedback(percentage)}
                            </div>
                            <div class="quiz-actions">
                                <button class="button button--secondary" onclick="startQuiz('${currentQuiz}')">
                                    Try Again
                                </button>
                                <button class="button button--primary" onclick="showNextModule()">
                                    Continue to Next Module
                                </button>
                            </div>
                        </div>
                    `;
                }

                function getQuizFeedback(percentage) {
                    if (percentage === 100) {
                        return `
                            <div class="feedback excellent">
                                <h4>Perfect Score!</h4>
                                <p>Excellent understanding of the concepts. You're ready to move on to the next module.</p>
                            </div>
                        `;
                    } else if (percentage >= 80) {
                        return `
                            <div class="feedback good">
                                <h4>Great Job!</h4>
                                <p>Strong grasp of the material. Review any missed questions and continue to the next module.</p>
                            </div>
                        `;
                    } else if (percentage >= 60) {
                        return `
                            <div class="feedback moderate">
                                <h4>Good Effort</h4>
                                <p>Consider reviewing the module material before moving on to ensure a solid foundation.</p>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="feedback needs-review">
                                <h4>Keep Learning</h4>
                                <p>We recommend reviewing the module content again before proceeding to ensure better understanding.</p>
                            </div>
                        `;
                    }
                }

                // Progress Tracking
                let moduleProgress = {
                    'compound-interest': 0,
                    'rule-of-72': 0,
                    'investment-types': 0,
                    'market-history': 0,
                    'bull-bear': 0,
                    'mutual-funds': 0
                };

                function updateProgress(moduleId, progress) {
                    moduleProgress[moduleId] = progress;
                    updateProgressUI();
                }

                function updateProgressUI() {
                    const totalProgress = Object.values(moduleProgress).reduce((a, b) => a + b, 0) / Object.keys(moduleProgress).length;
                    
                    document.getElementById('overallProgress').style.width = `${totalProgress}%`;
                    
                    // Update individual module indicators
                    Object.keys(moduleProgress).forEach(moduleId => {
                        const indicator = document.querySelector(`#${moduleId} .progress-indicator`);
                        if (indicator) {
                            indicator.style.width = `${moduleProgress[moduleId]}%`;
                            if (moduleProgress[moduleId] === 100) {
                                indicator.classList.add('complete');
                            }
                        }
                    });
                }
// S&P 500 Index Fund Comparison Tool
                function initializeIndexFundComparison() {
                    const fundData = {
                        'FNILX': {
                            name: 'Fidelity ZERO Large Cap Index',
                            expenseRatio: 0.00,
                            minInvestment: 0,
                            tenYearReturn: 14.44
                        },
                        'SWPPX': {
                            name: 'Schwab S&P 500 Index Fund',
                            expenseRatio: 0.02,
                            minInvestment: 0,
                            tenYearReturn: 13.66
                        },
                        'VFIAX': {
                            name: 'Vanguard 500 Index Admiral',
                            expenseRatio: 0.04,
                            minInvestment: 3000,
                            tenYearReturn: 13.49
                        }
                    };

                    const ctx = document.getElementById('indexFundComparisonChart').getContext('2d');
                    
                    // Destroy existing chart if it exists
                    if (window.indexFundChart) {
                        window.indexFundChart.destroy();
                    }

                    // Create comparison chart
                    window.indexFundChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(fundData).map(ticker => ticker),
                            datasets: [
                                {
                                    label: 'Expense Ratio (%)',
                                    data: Object.values(fundData).map(fund => fund.expenseRatio),
                                    backgroundColor: 'rgba(20, 107, 58, 0.6)',
                                    yAxisID: 'expense'
                                },
                                {
                                    label: '10-Year Return (%)',
                                    data: Object.values(fundData).map(fund => fund.tenYearReturn),
                                    backgroundColor: 'rgba(77, 99, 86, 0.6)',
                                    yAxisID: 'return'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                expense: {
                                    position: 'left',
                                    title: {
                                        display: true,
                                        text: 'Expense Ratio (%)'
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return value.toFixed(2) + '%';
                                        }
                                    }
                                },
                                return: {
                                    position: 'right',
                                    title: {
                                        display: true,
                                        text: '10-Year Return (%)'
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return value.toFixed(2) + '%';
                                        }
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: ${context.raw.toFixed(2)}%`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Create comparison table
                    const tableContainer = document.getElementById('indexFundTable');
                    tableContainer.innerHTML = `
                        <table class="fund-comparison-table">
                            <thead>
                                <tr>
                                    <th>Fund</th>
                                    <th>Expense Ratio</th>
                                    <th>Minimum Investment</th>
                                    <th>10-Year Return</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(fundData).map(([ticker, fund]) => `
                                    <tr>
                                        <td>
                                            <strong>${ticker}</strong><br>
                                            <span class="fund-name">${fund.name}</span>
                                        </td>
                                        <td>${fund.expenseRatio.toFixed(2)}%</td>
                                        <td>$${fund.minInvestment.toLocaleString()}</td>
                                        <td>${fund.tenYearReturn.toFixed(2)}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }

                // Dollar Cost Averaging Calculator
                function initializeDCACalculator() {
                    const dcaForm = document.getElementById('dcaCalculator');
                    dcaForm.innerHTML = `
                        <div class="calculator-section">
                            <h3>Dollar Cost Averaging Calculator</h3>
                            <div class="input-field">
                                <label>Monthly Investment ($)</label>
                                <input type="number" id="dcaAmount" value="500">
                            </div>
                            <div class="input-field">
                                <label>Investment Period (Years)</label>
                                <input type="number" id="dcaPeriod" value="10">
                            </div>
                            <div class="input-field">
                                <label>Expected Annual Return (%)</label>
                                <input type="number" id="dcaReturn" value="8">
                            </div>
                            <div class="input-field">
                                <label>Market Volatility Simulation</label>
                                <select id="dcaVolatility">
                                    <option value="low">Low (ยฑ10%)</option>
                                    <option value="medium" selected>Medium (ยฑ20%)</option>
                                    <option value="high">High (ยฑ30%)</option>
                                </select>
                            </div>
                            <button class="button button--primary" onclick="calculateDCA()">
                                Calculate DCA Strategy
                            </button>
                        </div>
                    `;
                }

                function calculateDCA() {
                    const monthlyInvestment = parseFloat(document.getElementById('dcaAmount').value);
                    const years = parseInt(document.getElementById('dcaPeriod').value);
                    const annualReturn = parseFloat(document.getElementById('dcaReturn').value) / 100;
                    const volatility = document.getElementById('dcaVolatility').value;

                    // Volatility factors
                    const volatilityRanges = {
                        low: 0.10,
                        medium: 0.20,
                        high: 0.30
                    };

                    let monthlyData = [];
                    let balance = 0;
                    let totalInvested = 0;
                    let monthlyReturns = [];

                    // Generate random monthly returns based on volatility
                    for (let i = 0; i < years * 12; i++) {
                        const volatilityFactor = volatilityRanges[volatility];
                        const randomReturn = (annualReturn / 12) + 
                            (Math.random() - 0.5) * volatilityFactor / Math.sqrt(12);
                        monthlyReturns.push(randomReturn);
                    }

                    // Calculate DCA results
                    for (let i = 0; i < years * 12; i++) {
                        balance = (balance * (1 + monthlyReturns[i])) + monthlyInvestment;
                        totalInvested += monthlyInvestment;
                        monthlyData.push({
                            month: i + 1,
                            balance: balance,
                            invested: totalInvested,
                            return: monthlyReturns[i]
                        });
                    }

                    displayDCAResults(monthlyData);
                }

                function displayDCAResults(data) {
                    const ctx = document.getElementById('dcaChart').getContext('2d');
                    
                    if (window.dcaChart) {
                        window.dcaChart.destroy();
                    }

                    window.dcaChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.map(d => `Month ${d.month}`),
                            datasets: [
                                {
                                    label: 'Portfolio Value',
                                    data: data.map(d => d.balance),
                                    borderColor: 'rgb(20, 107, 58)',
                                    backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                    fill: true
                                },
                                {
                                    label: 'Total Invested',
                                    data: data.map(d => d.invested),
                                    borderColor: 'rgb(77, 99, 86)',
                                    backgroundColor: 'rgba(77, 99, 86, 0.1)',
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.dataset.label}: $${context.raw.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    });

                    // Display summary statistics
                    const finalData = data[data.length - 1];
                    const totalReturn = ((finalData.balance / finalData.invested) - 1) * 100;

                    document.getElementById('dcaSummary').innerHTML = `
                        <div class="dca-summary">
                            <div class="summary-item">
                                <h4>Final Portfolio Value</h4>
                                <p>$${finalData.balance.toLocaleString('en-US', {
                                    minimumFractionDigits: 0,
                                    maximumFractionDigits: 0
                                })}</p>
                            </div>
                            <div class="summary-item">
                                <h4>Total Invested</h4>
                                <p>$${finalData.invested.toLocaleString('en-US', {
                                    minimumFractionDigits: 0,
                                    maximumFractionDigits: 0
                                })}</p>
                            </div>
                            <div class="summary-item">
                                <h4>Total Return</h4>
                                <p>${totalReturn.toFixed(2)}%</p>
                            </div>
                            <div class="summary-item">
                                <h4>Total Earnings</h4>
                                <p>$${(finalData.balance - finalData.invested).toLocaleString('en-US', {
                                    minimumFractionDigits: 0,
                                    maximumFractionDigits: 0
                                })}</p>
                            </div>
                        </div>
                    `;
                }
// Portfolio Risk Assessment Tool
                function initializeRiskAssessment() {
                    const questions = [
                        {
                            text: "What is your investment time horizon?",
                            options: [
                                { text: "Less than 5 years", score: 1 },
                                { text: "5-10 years", score: 2 },
                                { text: "10-20 years", score: 3 },
                                { text: "More than 20 years", score: 4 }
                            ]
                        },
                        {
                            text: "How would you react to a 20% decline in your portfolio?",
                            options: [
                                { text: "Sell everything immediately", score: 1 },
                                { text: "Sell some investments", score: 2 },
                                { text: "Hold steady", score: 3 },
                                { text: "Buy more investments", score: 4 }
                            ]
                        },
                        {
                            text: "What is your primary investment goal?",
                            options: [
                                { text: "Preserve capital", score: 1 },
                                { text: "Generate income", score: 2 },
                                { text: "Balanced growth and income", score: 3 },
                                { text: "Maximize long-term growth", score: 4 }
                            ]
                        }
                    ];

                    let currentQuestion = 0;
                    let riskScore = 0;

                    function displayRiskQuestion() {
                        const question = questions[currentQuestion];
                        document.getElementById('riskAssessment').innerHTML = `
                            <div class="risk-question">
                                <h3>Question ${currentQuestion + 1} of ${questions.length}</h3>
                                <p class="question-text">${question.text}</p>
                                <div class="options-container">
                                    ${question.options.map((option, index) => `
                                        <button class="option-button" onclick="selectRiskOption(${option.score})">
                                            ${option.text}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }

                    window.selectRiskOption = function(score) {
                        riskScore += score;
                        currentQuestion++;
                        
                        if (currentQuestion < questions.length) {
                            displayRiskQuestion();
                        } else {
                            showRiskResults();
                        }
                    };

                    function showRiskResults() {
                        const averageScore = riskScore / questions.length;
                        let riskProfile;
                        let recommendedPortfolio;

                        if (averageScore <= 1.5) {
                            riskProfile = {
                                type: "Conservative",
                                description: "Focus on capital preservation with minimal risk",
                                allocation: {
                                    stocks: 20,
                                    bonds: 70,
                                    cash: 10
                                }
                            };
                        } else if (averageScore <= 2.5) {
                            riskProfile = {
                                type: "Moderate Conservative",
                                description: "Balanced approach with emphasis on stability",
                                allocation: {
                                    stocks: 40,
                                    bonds: 50,
                                    cash: 10
                                }
                            };
                        } else if (averageScore <= 3.5) {
                            riskProfile = {
                                type: "Moderate Aggressive",
                                description: "Growth-oriented with calculated risks",
                                allocation: {
                                    stocks: 70,
                                    bonds: 25,
                                    cash: 5
                                }
                            };
                        } else {
                            riskProfile = {
                                type: "Aggressive",
                                description: "Maximum growth potential with higher volatility",
                                allocation: {
                                    stocks: 90,
                                    bonds: 10,
                                    cash: 0
                                }
                            };
                        }

                        // Display results with allocation chart
                        document.getElementById('riskAssessment').innerHTML = `
                            <div class="risk-results">
                                <h3>Your Risk Profile: ${riskProfile.type}</h3>
                                <p class="profile-description">${riskProfile.description}</p>
                                
                                <div class="allocation-chart-container">
                                    <canvas id="allocationChart"></canvas>
                                </div>
                                
                                <div class="recommended-allocation">
                                    <h4>Recommended Asset Allocation</h4>
                                    <div class="allocation-grid">
                                        <div class="allocation-item">
                                            <span class="label">Stocks</span>
                                            <span class="value">${riskProfile.allocation.stocks}%</span>
                                        </div>
                                        <div class="allocation-item">
                                            <span class="label">Bonds</span>
                                            <span class="value">${riskProfile.allocation.bonds}%</span>
                                        </div>
                                        <div class="allocation-item">
                                            <span class="label">Cash</span>
                                            <span class="value">${riskProfile.allocation.cash}%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="investment-recommendations">
                                    <h4>Recommended Investment Vehicles</h4>
                                    ${generateInvestmentRecommendations(riskProfile.type)}
                                </div>
                                
                                <button class="button button--primary" onclick="generateInvestmentPlan()">
                                    Create Detailed Investment Plan
                                </button>
                            </div>
                        `;

                        // Create allocation pie chart
                        const ctx = document.getElementById('allocationChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Stocks', 'Bonds', 'Cash'],
                                datasets: [{
                                    data: [
                                        riskProfile.allocation.stocks,
                                        riskProfile.allocation.bonds,
                                        riskProfile.allocation.cash
                                    ],
                                    backgroundColor: [
                                        'rgba(20, 107, 58, 0.8)',
                                        'rgba(77, 99, 86, 0.8)',
                                        'rgba(156, 244, 179, 0.8)'
                                    ]
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'right'
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.label}: ${context.raw}%`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }

                    function generateInvestmentRecommendations(riskProfile) {
                        const recommendations = {
                            Conservative: [
                                "High-quality bond index funds",
                                "Short-term government bonds",
                                "Blue-chip dividend stocks",
                                "Money market funds"
                            ],
                            "Moderate Conservative": [
                                "Total market index funds",
                                "Corporate bond funds",
                                "Dividend-focused ETFs",
                                "Municipal bonds"
                            ],
                            "Moderate Aggressive": [
                                "Growth stock index funds",
                                "Small-cap index funds",
                                "International equity funds",
                                "Corporate bonds"
                            ],
                            Aggressive: [
                                "Small-cap growth funds",
                                "Emerging market funds",
                                "Sector-specific ETFs",
                                "High-yield bonds"
                            ]
                        };

                        return `
                            <ul class="recommendations-list">
                                ${recommendations[riskProfile].map(rec => `
                                    <li class="recommendation-item">${rec}</li>
                                `).join('')}
                            </ul>
                        `;
                    }

                    // Start the risk assessment
                    displayRiskQuestion();
                }

                // Historical Market Performance Simulator
                function initializeMarketSimulator() {
                    const historicalData = {
                        "1928-1940": {
                            period: "Great Depression Era",
                            sp500Return: -0.89,
                            bondReturn: 4.96,
                            events: ["Stock Market Crash of 1929", "Banking Crisis", "New Deal Programs"]
                        },
                        "1941-1950": {
                            period: "World War II & Recovery",
                            sp500Return: 8.87,
                            bondReturn: 2.32,
                            events: ["War Economy", "Post-War Boom", "Marshall Plan"]
                        },
                        // Add more historical periods...
                    };

                    let simulationAmount = 10000;
                    let startYear = 1928;
                    let endYear = 2023;

// Continue Market Simulator
                    function simulateHistoricalPerformance(amount, startYear, endYear) {
                        const chartData = {
                            labels: [],
                            sp500Values: [],
                            bondValues: [],
                            events: []
                        };

                        let sp500Value = amount;
                        let bondValue = amount;

                        // Historical average returns by decade
                        const decadeData = {
                            "1920s": { sp500: 0.241, bonds: 0.045, events: ["Roaring Twenties", "Market Crash 1929"] },
                            "1930s": { sp500: -0.005, bonds: 0.032, events: ["Great Depression", "New Deal"] },
                            "1940s": { sp500: 0.092, bonds: 0.023, events: ["WWII", "Post-War Boom"] },
                            "1950s": { sp500: 0.195, bonds: 0.022, events: ["Bull Market", "Economic Expansion"] },
                            "1960s": { sp500: 0.076, bonds: 0.033, events: ["Go-Go Years", "Space Race"] },
                            "1970s": { sp500: 0.058, bonds: 0.062, events: ["Stagflation", "Oil Crisis"] },
                            "1980s": { sp500: 0.172, bonds: 0.124, events: ["Reagan Era", "Bull Market"] },
                            "1990s": { sp500: 0.182, bonds: 0.074, events: ["Tech Boom", "Globalization"] },
                            "2000s": { sp500: -0.009, bonds: 0.065, events: ["Dot-com Bust", "Financial Crisis"] },
                            "2010s": { sp500: 0.139, bonds: 0.035, events: ["Bull Market", "Low Rates"] },
                            "2020s": { sp500: 0.105, bonds: 0.021, events: ["Pandemic", "Recovery"] }
                        };

                        for (let year = startYear; year <= endYear; year++) {
                            const decade = `${Math.floor(year/10)}0s`;
                            const yearData = decadeData[decade];

                            if (yearData) {
                                sp500Value *= (1 + yearData.sp500);
                                bondValue *= (1 + yearData.bonds);

                                chartData.labels.push(year.toString());
                                chartData.sp500Values.push(sp500Value);
                                chartData.bondValues.push(bondValue);
                                
                                // Add significant events
                                if (yearData.events) {
                                    chartData.events = [...chartData.events, ...yearData.events];
                                }
                            }
                        }

                        return chartData;
                    }

                    function displayMarketSimulation() {
                        const amount = parseFloat(document.getElementById('simulationAmount').value);
                        const startYear = parseInt(document.getElementById('startYear').value);
                        const endYear = parseInt(document.getElementById('endYear').value);

                        const data = simulateHistoricalPerformance(amount, startYear, endYear);

                        // Create interactive chart
                        const ctx = document.getElementById('marketSimulationChart').getContext('2d');
                        if (window.marketSimChart) {
                            window.marketSimChart.destroy();
                        }

                        window.marketSimChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: data.labels,
                                datasets: [
                                    {
                                        label: 'S&P 500',
                                        data: data.sp500Values,
                                        borderColor: 'rgb(20, 107, 58)',
                                        backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                        fill: true
                                    },
                                    {
                                        label: 'Bonds',
                                        data: data.bondValues,
                                        borderColor: 'rgb(77, 99, 86)',
                                        backgroundColor: 'rgba(77, 99, 86, 0.1)',
                                        fill: true
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: {
                                    mode: 'index',
                                    intersect: false
                                },
                                plugins: {
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.dataset.label}: $${context.raw.toLocaleString('en-US', {
                                                    minimumFractionDigits: 0,
                                                    maximumFractionDigits: 0
                                                })}`;
                                            }
                                        }
                                    },
                                    annotation: {
                                        annotations: generateEventAnnotations(data.events)
                                    }
                                },
                                scales: {
                                    y: {
                                        type: 'logarithmic',
                                        ticks: {
                                            callback: function(value) {
                                                return '$' + value.toLocaleString('en-US');
                                            }
                                        }
                                    }
                                }
                            }
                        });

                        // Display historical context and analysis
                        displayHistoricalAnalysis(data);
                    }

                    function displayHistoricalAnalysis(data) {
                        const startValue = data.sp500Values[0];
                        const endValueSP500 = data.sp500Values[data.sp500Values.length - 1];
                        const endValueBonds = data.bondValues[data.bondValues.length - 1];

                        const sp500Return = ((endValueSP500 / startValue) - 1) * 100;
                        const bondReturn = ((endValueBonds / startValue) - 1) * 100;

                        document.getElementById('marketAnalysis').innerHTML = `
                            <div class="analysis-container">
                                <div class="performance-summary">
                                    <h3>Investment Performance Summary</h3>
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <h4>S&P 500 Return</h4>
                                            <p class="return ${sp500Return >= 0 ? 'positive' : 'negative'}">
                                                ${sp500Return.toFixed(2)}%
                                            </p>
                                            <p class="value">Final Value: $${endValueSP500.toLocaleString('en-US')}</p>
                                        </div>
                                        <div class="summary-item">
                                            <h4>Bond Return</h4>
                                            <p class="return ${bondReturn >= 0 ? 'positive' : 'negative'}">
                                                ${bondReturn.toFixed(2)}%
                                            </p>
                                            <p class="value">Final Value: $${endValueBonds.toLocaleString('en-US')}</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="historical-events">
                                    <h3>Significant Market Events</h3>
                                    <div class="event-timeline">
                                        ${data.events.map(event => `
                                            <div class="event-item">
                                                <span class="event-marker"></span>
                                                <p class="event-text">${event}</p>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <div class="key-lessons">
                                    <h3>Key Investment Lessons</h3>
                                    <ul class="lessons-list">
                                        <li>Long-term investing tends to smooth out short-term volatility</li>
                                        <li>Diversification between stocks and bonds can reduce risk</li>
                                        <li>Markets have historically recovered from every downturn</li>
                                        <li>Different assets perform differently in various economic conditions</li>
                                    </ul>
                                </div>
                            </div>
                        `;

                        // Add interactive tooltips for educational content
                        initializeTooltips();
                    }

                    function generateEventAnnotations(events) {
                        return events.map((event, index) => ({
                            type: 'line',
                            yMin: 0,
                            yMax: 1,
                            borderColor: 'rgba(0, 0, 0, 0.1)',
                            borderWidth: 1,
                            label: {
                                content: event,
                                enabled: true,
                                position: 'top'
                            }
                        }));
                    }

                    // Interactive Educational Features
                    function initializeTooltips() {
                        const tooltipElements = document.querySelectorAll('[data-tooltip]');
                        tooltipElements.forEach(element => {
                            element.addEventListener('mouseover', showTooltip);
                            element.addEventListener('mouseout', hideTooltip);
                        });
                    }

// Interactive Small Cap vs Large Cap Comparison
                    function initializeCapComparison() {
                        const historicalData = {
                            "Small Cap Value": {
                                returns: [
                                    { year: "1927-1937", return: 12.5 },
                                    { year: "1937-1947", return: 15.2 },
                                    { year: "1947-1957", return: 18.7 },
                                    { year: "1957-1967", return: 14.3 },
                                    { year: "1967-1977", return: 11.8 },
                                    { year: "1977-1987", return: 21.4 },
                                    { year: "1987-1997", return: 17.6 },
                                    { year: "1997-2007", return: 13.9 },
                                    { year: "2007-2017", return: 9.8 },
                                    { year: "2017-2023", return: 10.2 }
                                ],
                                characteristics: [
                                    "Higher historical returns",
                                    "More volatile",
                                    "Less liquid",
                                    "Higher transaction costs",
                                    "Less analyst coverage"
                                ]
                            },
                            "S&P 500": {
                                returns: [
                                    { year: "1927-1937", return: 9.2 },
                                    { year: "1937-1947", return: 11.8 },
                                    { year: "1947-1957", return: 15.4 },
                                    { year: "1957-1967", return: 11.2 },
                                    { year: "1967-1977", return: 8.9 },
                                    { year: "1977-1987", return: 17.2 },
                                    { year: "1987-1997", return: 15.3 },
                                    { year: "1997-2007", return: 11.7 },
                                    { year: "2007-2017", return: 8.5 },
                                    { year: "2017-2023", return: 9.8 }
                                ],
                                characteristics: [
                                    "More stable returns",
                                    "Higher liquidity",
                                    "Lower transaction costs",
                                    "Extensive analyst coverage",
                                    "Better transparency"
                                ]
                            }
                        };

                        function createCapComparisonChart() {
                            const ctx = document.getElementById('capComparisonChart').getContext('2d');
                            const smallCapData = historicalData["Small Cap Value"].returns;
                            const sp500Data = historicalData["S&P 500"].returns;

                            if (window.capComparisonChart) {
                                window.capComparisonChart.destroy();
                            }

                            window.capComparisonChart = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: smallCapData.map(d => d.year),
                                    datasets: [
                                        {
                                            label: 'Small Cap Value',
                                            data: smallCapData.map(d => d.return),
                                            borderColor: 'rgb(20, 107, 58)',
                                            backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                            fill: true
                                        },
                                        {
                                            label: 'S&P 500',
                                            data: sp500Data.map(d => d.return),
                                            borderColor: 'rgb(77, 99, 86)',
                                            backgroundColor: 'rgba(77, 99, 86, 0.1)',
                                            fill: true
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        tooltip: {
                                            callbacks: {
                                                label: function(context) {
                                                    return `${context.dataset.label}: ${context.raw}% annual return`;
                                                }
                                            }
                                        }
                                    },
                                    scales: {
                                        y: {
                                            ticks: {
                                                callback: function(value) {
                                                    return value + '%';
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }

                        // Create interactive comparison table
                        function createComparisonTable() {
                            return `
                                <div class="comparison-table-container">
                                    <table class="comparison-table">
                                        <thead>
                                            <tr>
                                                <th>Characteristic</th>
                                                <th>Small Cap Value</th>
                                                <th>S&P 500</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${generateComparisonRows()}
                                        </tbody>
                                    </table>
                                </div>
                            `;
                        }

                        function generateComparisonRows() {
                            const characteristics = [
                                {
                                    feature: "Historical Returns",
                                    smallCap: "Higher (12-15% avg)",
                                    sp500: "Lower (9-11% avg)"
                                },
                                {
                                    feature: "Volatility",
                                    smallCap: "Higher",
                                    sp500: "Lower"
                                },
                                {
                                    feature: "Liquidity",
                                    smallCap: "Lower",
                                    sp500: "Higher"
                                },
                                {
                                    feature: "Transaction Costs",
                                    smallCap: "Higher",
                                    sp500: "Lower"
                                },
                                {
                                    feature: "Analyst Coverage",
                                    smallCap: "Limited",
                                    sp500: "Extensive"
                                }
                            ];

                            return characteristics.map(char => `
                                <tr>
                                    <td class="feature">${char.feature}</td>
                                    <td class="small-cap">${char.smallCap}</td>
                                    <td class="sp500">${char.sp500}</td>
                                </tr>
                            `).join('');
                        }

                        // Create Fama-French Factor Analysis
                        function createFactorAnalysis() {
                            return `
                                <div class="factor-analysis">
                                    <h3>Fama-French Three-Factor Model Explanation</h3>
                                    <div class="factor-grid">
                                        <div class="factor-card">
                                            <h4>Market Factor (Beta)</h4>
                                            <p>Measures sensitivity to overall market movements</p>
                                            <div class="factor-impact">
                                                <span class="label">Impact:</span>
                                                <div class="impact-bar" style="width: 80%"></div>
                                            </div>
                                        </div>
                                        <div class="factor-card">
                                            <h4>Size Factor (SMB)</h4>
                                            <p>Small minus Big: Return premium for small companies</p>
                                            <div class="factor-impact">
                                                <span class="label">Impact:</span>
                                                <div class="impact-bar" style="width: 60%"></div>
                                            </div>
                                        </div>
                                        <div class="factor-card">
                                            <h4>Value Factor (HML)</h4>
                                            <p>High minus Low: Return premium for value stocks</p>
                                            <div class="factor-impact">
                                                <span class="label">Impact:</span>
                                                <div class="impact-bar" style="width: 70%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }

                        // Initialize the complete comparison section
                        document.getElementById('capComparison').innerHTML = `
                            <div class="cap-comparison-container">
                                <div class="chart-section">
                                    <h3>Historical Performance Comparison</h3>
                                    <div class="chart-container">
                                        <canvas id="capComparisonChart"></canvas>
                                    </div>
                                </div>
                                ${createComparisonTable()}
                                ${createFactorAnalysis()}
                                <div class="interactive-calculator">
                                    <h3>Investment Growth Calculator</h3>
                                    <div class="calculator-inputs">
                                        <div class="input-field">
                                            <label>Initial Investment ($)</label>
                                            <input type="number" id="capCalcAmount" value="10000">
                                        </div>
                                        <div class="input-field">
                                            <label>Investment Period (Years)</label>
                                            <input type="number" id="capCalcYears" value="20">
                                        </div>
                                        <button class="button button--primary" onclick="calculateCapComparison()">
                                            Compare Growth
                                        </button>
                                    </div>
                                    <div id="capCalcResults" class="calculator-results"></div>
                                </div>
                            </div>
                        `;

                        // Initialize the chart
                        createCapComparisonChart();
                    }
// Interactive Small Cap vs Large Cap Comparison
                    function initializeCapComparison() {
                        const historicalData = {
                            "Small Cap Value": {
                                returns: [
                                    { year: "1927-1937", return: 12.5 },
                                    { year: "1937-1947", return: 15.2 },
                                    { year: "1947-1957", return: 18.7 },
                                    { year: "1957-1967", return: 14.3 },
                                    { year: "1967-1977", return: 11.8 },
                                    { year: "1977-1987", return: 21.4 },
                                    { year: "1987-1997", return: 17.6 },
                                    { year: "1997-2007", return: 13.9 },
                                    { year: "2007-2017", return: 9.8 },
                                    { year: "2017-2023", return: 10.2 }
                                ],
                                characteristics: [
                                    "Higher historical returns",
                                    "More volatile",
                                    "Less liquid",
                                    "Higher transaction costs",
                                    "Less analyst coverage"
                                ]
                            },
                            "S&P 500": {
                                returns: [
                                    { year: "1927-1937", return: 9.2 },
                                    { year: "1937-1947", return: 11.8 },
                                    { year: "1947-1957", return: 15.4 },
                                    { year: "1957-1967", return: 11.2 },
                                    { year: "1967-1977", return: 8.9 },
                                    { year: "1977-1987", return: 17.2 },
                                    { year: "1987-1997", return: 15.3 },
                                    { year: "1997-2007", return: 11.7 },
                                    { year: "2007-2017", return: 8.5 },
                                    { year: "2017-2023", return: 9.8 }
                                ],
                                characteristics: [
                                    "More stable returns",
                                    "Higher liquidity",
                                    "Lower transaction costs",
                                    "Extensive analyst coverage",
                                    "Better transparency"
                                ]
                            }
                        };

                        function createCapComparisonChart() {
                            const ctx = document.getElementById('capComparisonChart').getContext('2d');
                            const smallCapData = historicalData["Small Cap Value"].returns;
                            const sp500Data = historicalData["S&P 500"].returns;

                            if (window.capComparisonChart) {
                                window.capComparisonChart.destroy();
                            }

                            window.capComparisonChart = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: smallCapData.map(d => d.year),
                                    datasets: [
                                        {
                                            label: 'Small Cap Value',
                                            data: smallCapData.map(d => d.return),
                                            borderColor: 'rgb(20, 107, 58)',
                                            backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                            fill: true
                                        },
                                        {
                                            label: 'S&P 500',
                                            data: sp500Data.map(d => d.return),
                                            borderColor: 'rgb(77, 99, 86)',
                                            backgroundColor: 'rgba(77, 99, 86, 0.1)',
                                            fill: true
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        tooltip: {
                                            callbacks: {
                                                label: function(context) {
                                                    return `${context.dataset.label}: ${context.raw}% annual return`;
                                                }
                                            }
                                        }
                                    },
                                    scales: {
                                        y: {
                                            ticks: {
                                                callback: function(value) {
                                                    return value + '%';
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }

                        // Create interactive comparison table
                        function createComparisonTable() {
                            return `
                                <div class="comparison-table-container">
                                    <table class="comparison-table">
                                        <thead>
                                            <tr>
                                                <th>Characteristic</th>
                                                <th>Small Cap Value</th>
                                                <th>S&P 500</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${generateComparisonRows()}
                                        </tbody>
                                    </table>
                                </div>
                            `;
                        }

                        function generateComparisonRows() {
                            const characteristics = [
                                {
                                    feature: "Historical Returns",
                                    smallCap: "Higher (12-15% avg)",
                                    sp500: "Lower (9-11% avg)"
                                },
                                {
                                    feature: "Volatility",
                                    smallCap: "Higher",
                                    sp500: "Lower"
                                },
                                {
                                    feature: "Liquidity",
                                    smallCap: "Lower",
                                    sp500: "Higher"
                                },
                                {
                                    feature: "Transaction Costs",
                                    smallCap: "Higher",
                                    sp500: "Lower"
                                },
                                {
                                    feature: "Analyst Coverage",
                                    smallCap: "Limited",
                                    sp500: "Extensive"
                                }
                            ];

                            return characteristics.map(char => `
                                <tr>
                                    <td class="feature">${char.feature}</td>
                                    <td class="small-cap">${char.smallCap}</td>
                                    <td class="sp500">${char.sp500}</td>
                                </tr>
                            `).join('');
                        }

                        // Create Fama-French Factor Analysis
                        function createFactorAnalysis() {
                            return `
                                <div class="factor-analysis">
                                    <h3>Fama-French Three-Factor Model Explanation</h3>
                                    <div class="factor-grid">
                                        <div class="factor-card">
                                            <h4>Market Factor (Beta)</h4>
                                            <p>Measures sensitivity to overall market movements</p>
                                            <div class="factor-impact">
                                                <span class="label">Impact:</span>
                                                <div class="impact-bar" style="width: 80%"></div>
                                            </div>
                                        </div>
                                        <div class="factor-card">
                                            <h4>Size Factor (SMB)</h4>
                                            <p>Small minus Big: Return premium for small companies</p>
                                            <div class="factor-impact">
                                                <span class="label">Impact:</span>
                                                <div class="impact-bar" style="width: 60%"></div>
                                            </div>
                                        </div>
                                        <div class="factor-card">
                                            <h4>Value Factor (HML)</h4>
                                            <p>High minus Low: Return premium for value stocks</p>
                                            <div class="factor-impact">
                                                <span class="label">Impact:</span>
                                                <div class="impact-bar" style="width: 70%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }

                        // Initialize the complete comparison section
                        document.getElementById('capComparison').innerHTML = `
                            <div class="cap-comparison-container">
                                <div class="chart-section">
                                    <h3>Historical Performance Comparison</h3>
                                    <div class="chart-container">
                                        <canvas id="capComparisonChart"></canvas>
                                    </div>
                                </div>
                                ${createComparisonTable()}
                                ${createFactorAnalysis()}
                                <div class="interactive-calculator">
                                    <h3>Investment Growth Calculator</h3>
                                    <div class="calculator-inputs">
                                        <div class="input-field">
                                            <label>Initial Investment ($)</label>
                                            <input type="number" id="capCalcAmount" value="10000">
                                        </div>
                                        <div class="input-field">
                                            <label>Investment Period (Years)</label>
                                            <input type="number" id="capCalcYears" value="20">
                                        </div>
                                        <button class="button button--primary" onclick="calculateCapComparison()">
                                            Compare Growth
                                        </button>
                                    </div>
                                    <div id="capCalcResults" class="calculator-results"></div>
                                </div>
                            </div>
                        `;

                        // Initialize the chart
                        createCapComparisonChart();
                    }
// IRA Account Type Comparison Tool
                    function initializeIRAComparison() {
                        const iraTypes = {
                            traditional: {
                                name: "Traditional IRA",
                                features: {
                                    contributions: "Pre-tax dollars",
                                    taxBenefit: "Tax-deferred growth",
                                    withdrawals: "Taxed as ordinary income",
                                    rmdRequired: "Yes, starting at age 73",
                                    incomeLimits: "No income limits for contributions",
                                    deductibility: "May be tax-deductible"
                                },
                                bestFor: [
                                    "Expect lower tax bracket in retirement",
                                    "Want immediate tax benefits",
                                    "Not eligible for Roth IRA",
                                    "Higher current income bracket"
                                ]
                            },
                            roth: {
                                name: "Roth IRA",
                                features: {
                                    contributions: "After-tax dollars",
                                    taxBenefit: "Tax-free growth",
                                    withdrawals: "Tax-free if qualified",
                                    rmdRequired: "No RMDs required",
                                    incomeLimits: "Income limits apply",
                                    deductibility: "Not tax-deductible"
                                },
                                bestFor: [
                                    "Expect higher tax bracket in retirement",
                                    "Want tax-free withdrawals",
                                    "Younger investors",
                                    "Want to avoid RMDs"
                                ]
                            }
                        };

                        function createIRACalculator() {
                            return `
                                <div class="ira-calculator">
                                    <h3>IRA Comparison Calculator</h3>
                                    <div class="calculator-inputs">
                                        <div class="input-group">
                                            <h4>Current Situation</h4>
                                            <div class="input-field">
                                                <label>Current Age</label>
                                                <input type="number" id="currentAge" value="30">
                                            </div>
                                            <div class="input-field">
                                                <label>Current Tax Bracket (%)</label>
                                                <input type="number" id="currentTaxRate" value="24">
                                            </div>
                                            <div class="input-field">
                                                <label>Expected Retirement Age</label>
                                                <input type="number" id="retirementAge" value="65">
                                            </div>
                                        </div>
                                        <div class="input-group">
                                            <h4>Investment Details</h4>
                                            <div class="input-field">
                                                <label>Annual Contribution ($)</label>
                                                <input type="number" id="annualContribution" value="6000">
                                            </div>
                                            <div class="input-field">
                                                <label>Expected Annual Return (%)</label>
                                                <input type="number" id="expectedReturn" value="7">
                                            </div>
                                            <div class="input-field">
                                                <label>Expected Retirement Tax Bracket (%)</label>
                                                <input type="number" id="retirementTaxRate" value="22">
                                            </div>
                                        </div>
                                        <button class="button button--primary" onclick="compareIRAOptions()">
                                            Compare IRA Options
                                        </button>
                                    </div>
                                    <div id="iraComparisonResults" class="comparison-results"></div>
                                </div>
                            `;
                        }

                        function compareIRAOptions() {
                            const currentAge = parseInt(document.getElementById('currentAge').value);
                            const currentTaxRate = parseInt(document.getElementById('currentTaxRate').value) / 100;
                            const retirementAge = parseInt(document.getElementById('retirementAge').value);
                            const annualContribution = parseFloat(document.getElementById('annualContribution').value);
                            const expectedReturn = parseFloat(document.getElementById('expectedReturn').value) / 100;
                            const retirementTaxRate = parseInt(document.getElementById('retirementTaxRate').value) / 100;

                            const years = retirementAge - currentAge;

                            // Traditional IRA Calculation
                            let traditionalBalance = 0;
                            let traditionalTaxSavings = annualContribution * currentTaxRate * years;
                            
                            // Roth IRA Calculation
                            let rothBalance = 0;

                            // Calculate growth for both accounts
                            for (let i = 0; i < years; i++) {
                                traditionalBalance = (traditionalBalance + annualContribution) * (1 + expectedReturn);
                                rothBalance = (rothBalance + annualContribution) * (1 + expectedReturn);
                            }

                            // After-tax value at retirement
                            const traditionalAfterTax = traditionalBalance * (1 - retirementTaxRate);
                            const rothAfterTax = rothBalance; // Already after-tax

                            displayIRAComparison({
                                traditional: {
                                    balance: traditionalBalance,
                                    afterTax: traditionalAfterTax,
                                    taxSavings: traditionalTaxSavings
                                },
                                roth: {
                                    balance: rothBalance,
                                    afterTax: rothAfterTax,
                                    taxSavings: 0
                                }
                            });
                        }

                        function displayIRAComparison(results) {
                            const resultsContainer = document.getElementById('iraComparisonResults');
                            resultsContainer.innerHTML = `
                                <div class="results-grid">
                                    <div class="result-column traditional">
                                        <h4>Traditional IRA</h4>
                                        <div class="result-item">
                                            <label>Account Balance at Retirement</label>
                                            <p class="value">$${results.traditional.balance.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}</p>
                                        </div>
                                        <div class="result-item">
                                            <label>After-Tax Value</label>
                                            <p class="value">$${results.traditional.afterTax.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}</p>
                                        </div>
                                        <div class="result-item">
                                            <label>Immediate Tax Savings</label>
                                            <p class="value">$${results.traditional.taxSavings.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}</p>
                                        </div>
                                    </div>
                                    <div class="result-column roth">
                                        <h4>Roth IRA</h4>
                                        <div class="result-item">
                                            <label>Account Balance at Retirement</label>
                                            <p class="value">$${results.roth.balance.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}</p>
                                        </div>
                                        <div class="result-item">
                                            <label>After-Tax Value</label>
                                            <p class="value">$${results.roth.afterTax.toLocaleString('en-US', {
                                                minimumFractionDigits: 0,
                                                maximumFractionDigits: 0
                                            })}</p>
                                        </div>
                                        <div class="result-item">
                                            <label>Immediate Tax Savings</label>
                                            <p class="value">$0</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="recommendation-section">
                                    ${generateIRARecommendation(results)}
                                </div>
                            `;
                        }

                        function generateIRARecommendation(results) {
                            const traditionalBetter = results.traditional.afterTax > results.roth.afterTax;
                            
                            return `
                                <div class="recommendation">
                                    <h4>Recommendation</h4>
                                    <p>${traditionalBetter ? 
                                        'Based on your inputs, a Traditional IRA may be more advantageous due to the immediate tax savings and your expected lower tax bracket in retirement.' :
                                        'Based on your inputs, a Roth IRA may be more advantageous due to tax-free growth and withdrawals, especially if you expect higher tax rates in retirement.'
                                    }</p>
                                    <div class="key-considerations">
                                        <h5>Key Considerations:</h5>
                                        <ul>
                                            ${generateKeyConsiderations(traditionalBetter)}
                                        </ul>
                                    </div>
                                </div>
                            `;
                        }
// Portfolio Rebalancing Simulator
                    function initializePortfolioRebalancer() {
                        const portfolioTypes = {
                            conservative: {
                                stocks: 30,
                                bonds: 60,
                                cash: 10
                            },
                            moderate: {
                                stocks: 60,
                                bonds: 35,
                                cash: 5
                            },
                            aggressive: {
                                stocks: 80,
                                bonds: 20,
                                cash: 0
                            }
                        };

                        function createRebalancingTool() {
                            return `
                                <div class="rebalancing-tool">
                                    <h3>Portfolio Rebalancing Tool</h3>
                                    <div class="tool-section">
                                        <div class="portfolio-setup">
                                            <h4>1. Select Portfolio Type</h4>
                                            <div class="portfolio-types">
                                                ${Object.keys(portfolioTypes).map(type => `
                                                    <button class="portfolio-type-btn" onclick="selectPortfolioType('${type}')">
                                                        ${type.charAt(0).toUpperCase() + type.slice(1)}
                                                    </button>
                                                `).join('')}
                                            </div>
                                        </div>
                                        <div class="current-allocation">
                                            <h4>2. Enter Current Allocation</h4>
                                            <div class="allocation-inputs">
                                                <div class="input-field">
                                                    <label>Current Stock Allocation (%)</label>
                                                    <input type="number" id="currentStocks" value="70">
                                                </div>
                                                <div class="input-field">
                                                    <label>Current Bond Allocation (%)</label>
                                                    <input type="number" id="currentBonds" value="25">
                                                </div>
                                                <div class="input-field">
                                                    <label>Current Cash Allocation (%)</label>
                                                    <input type="number" id="currentCash" value="5">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="portfolio-value">
                                            <h4>3. Enter Portfolio Value</h4>
                                            <div class="input-field">
                                                <label>Total Portfolio Value ($)</label>
                                                <input type="number" id="portfolioValue" value="100000">
                                            </div>
                                        </div>
                                        <button class="button button--primary" onclick="calculateRebalancing()">
                                            Calculate Rebalancing Needs
                                        </button>
                                    </div>
                                    <div id="rebalancingResults" class="rebalancing-results"></div>
                                </div>
                            `;
                        }

                        function selectPortfolioType(type) {
                            const allocation = portfolioTypes[type];
                            document.getElementById('currentStocks').value = allocation.stocks;
                            document.getElementById('currentBonds').value = allocation.bonds;
                            document.getElementById('currentCash').value = allocation.cash;
                            
                            // Update buttons to show selected state
                            document.querySelectorAll('.portfolio-type-btn').forEach(btn => {
                                btn.classList.remove('selected');
                                if (btn.textContent.toLowerCase() === type) {
                                    btn.classList.add('selected');
                                }
                            });
                        }

                        function calculateRebalancing() {
                            const portfolioValue = parseFloat(document.getElementById('portfolioValue').value);
                            const currentStocks = parseFloat(document.getElementById('currentStocks').value) / 100;
                            const currentBonds = parseFloat(document.getElementById('currentBonds').value) / 100;
                            const currentCash = parseFloat(document.getElementById('currentCash').value) / 100;

                            // Calculate current values
                            const stockValue = portfolioValue * currentStocks;
                            const bondValue = portfolioValue * currentBonds;
                            const cashValue = portfolioValue * currentCash;

                            // Get selected portfolio type
                            const selectedType = Array.from(document.querySelectorAll('.portfolio-type-btn'))
                                .find(btn => btn.classList.contains('selected'))?.textContent.toLowerCase() || 'moderate';
                            
                            const targetAllocation = portfolioTypes[selectedType];

                            // Calculate target values
                            const targetStockValue = portfolioValue * (targetAllocation.stocks / 100);
                            const targetBondValue = portfolioValue * (targetAllocation.bonds / 100);
                            const targetCashValue = portfolioValue * (targetAllocation.cash / 100);

                            // Calculate differences
                            const stockDiff = targetStockValue - stockValue;
                            const bondDiff = targetBondValue - bondValue;
                            const cashDiff = targetCashValue - cashValue;

                            displayRebalancingResults({
                                current: {
                                    stocks: stockValue,
                                    bonds: bondValue,
                                    cash: cashValue
                                },
                                target: {
                                    stocks: targetStockValue,
                                    bonds: targetBondValue,
                                    cash: targetCashValue
                                },
                                differences: {
                                    stocks: stockDiff,
                                    bonds: bondDiff,
                                    cash: cashDiff
                                }
                            });
                        }

                        function displayRebalancingResults(results) {
                            const resultsContainer = document.getElementById('rebalancingResults');
                            
                            const createActionMessage = (diff, assetType) => {
                                if (Math.abs(diff) < 1) return '';
                                const action = diff > 0 ? 'Buy' : 'Sell';
                                return `${action} ${assetType}: $${Math.abs(diff).toLocaleString('en-US', {
                                    minimumFractionDigits: 0,
                                    maximumFractionDigits: 0
                                })}`;
                            };

                            resultsContainer.innerHTML = `
                                <div class="rebalancing-summary">
                                    <div class="current-vs-target">
                                        <div class="allocation-chart">
                                            <canvas id="allocationChart"></canvas>
                                        </div>
                                        <div class="action-items">
                                            <h4>Required Actions</h4>
                                            <ul class="action-list">
                                                ${createActionMessage(results.differences.stocks, 'Stocks')}
                                                ${createActionMessage(results.differences.bonds, 'Bonds')}
                                                ${createActionMessage(results.differences.cash, 'Cash')}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="rebalancing-tips">
                                        <h4>Rebalancing Tips</h4>
                                        <ul>
                                            <li>Consider tax implications when selling assets</li>
                                            <li>Use new contributions to rebalance when possible</li>
                                            <li>Monitor transaction costs</li>
                                            <li>Consider rebalancing when allocations drift more than 5%</li>
                                        </ul>
                                    </div>
                                </div>
                            `;

                            // Create allocation chart
                            const ctx = document.getElementById('allocationChart').getContext('2d');
                            new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: ['Stocks', 'Bonds', 'Cash'],
                                    datasets: [
                                        {
                                            label: 'Current Allocation',
                                            data: [
                                                results.current.stocks,
                                                results.current.bonds,
                                                results.current.cash
                                            ],
                                            backgroundColor: 'rgba(20, 107, 58, 0.6)'
                                        },
                                        {
                                            label: 'Target Allocation',
                                            data: [
                                                results.target.stocks,
                                                results.target.bonds,
                                                results.target.cash
                                            ],
                                            backgroundColor: 'rgba(77, 99, 86, 0.6)'
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            ticks: {
                                                callback: function(value) {
                                                    return '$' + value.toLocaleString('en-US', {
                                                        minimumFractionDigits: 0,
                                                        maximumFractionDigits: 0
                                                    });
                                                }
                                            }
                                        }
                                    },
                                    plugins: {
                                        tooltip: {
                                            callbacks: {
                                                label: function(context) {
                                                    return context.dataset.label + ': $' + 
                                                        context.raw.toLocaleString('en-US', {
                                                            minimumFractionDigits: 0,
                                                            maximumFractionDigits: 0
                                                        });
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }
// Mutual Fund Evaluation Tool
                    function initializeFundEvaluator() {
                        const evaluationCriteria = {
                            expenseRatio: {
                                excellent: 0.20,
                                good: 0.50,
                                fair: 0.75,
                                poor: 1.00
                            },
                            morningstarRating: {
                                weight: 0.25,
                                threshold: 4
                            },
                            performanceMetrics: {
                                oneYear: { weight: 0.10 },
                                threeYear: { weight: 0.20 },
                                fiveYear: { weight: 0.30 },
                                tenYear: { weight: 0.40 }
                            }
                        };

                        function createFundEvaluatorTool() {
                            return `
                                <div class="fund-evaluator">
                                    <h3>Mutual Fund Evaluation Tool</h3>
                                    
                                    <div class="evaluator-section">
                                        <div class="fund-info">
                                            <div class="input-field">
                                                <label>Fund Ticker Symbol</label>
                                                <input type="text" id="fundTicker" placeholder="e.g., VFIAX">
                                                <button class="button button--secondary" onclick="lookupFund()">
                                                    <span class="material-symbols-rounded">search</span>
                                                    Look up Fund
                                                </button>
                                            </div>
                                        </div>

                                        <div class="evaluation-criteria">
                                            <h4>Performance Metrics</h4>
                                            <div class="metrics-grid">
                                                <div class="input-field">
                                                    <label>1-Year Return (%)</label>
                                                    <input type="number" id="oneYearReturn" step="0.01">
                                                </div>
                                                <div class="input-field">
                                                    <label>3-Year Return (%)</label>
                                                    <input type="number" id="threeYearReturn" step="0.01">
                                                </div>
                                                <div class="input-field">
                                                    <label>5-Year Return (%)</label>
                                                    <input type="number" id="fiveYearReturn" step="0.01">
                                                </div>
                                                <div class="input-field">
                                                    <label>10-Year Return (%)</label>
                                                    <input type="number" id="tenYearReturn" step="0.01">
                                                </div>
                                            </div>

                                            <h4>Risk & Cost Metrics</h4>
                                            <div class="metrics-grid">
                                                <div class="input-field">
                                                    <label>Expense Ratio (%)</label>
                                                    <input type="number" id="expenseRatio" step="0.01">
                                                </div>
                                                <div class="input-field">
                                                    <label>Morningstar Rating (1-5)</label>
                                                    <input type="number" id="morningstarRating" min="1" max="5">
                                                </div>
                                                <div class="input-field">
                                                    <label>Standard Deviation</label>
                                                    <input type="number" id="standardDev" step="0.01">
                                                </div>
                                                <div class="input-field">
                                                    <label>Sharpe Ratio</label>
                                                    <input type="number" id="sharpeRatio" step="0.01">
                                                </div>
                                            </div>

                                            <h4>ESG & Sustainability</h4>
                                            <div class="metrics-grid">
                                                <div class="input-field">
                                                    <label>ESG Score (1-100)</label>
                                                    <input type="number" id="esgScore" min="1" max="100">
                                                </div>
                                                <div class="input-field">
                                                    <label>Carbon Risk Score</label>
                                                    <input type="number" id="carbonRisk" min="0" max="100">
                                                </div>
                                            </div>
                                        </div>

                                        <button class="button button--primary" onclick="evaluateFund()">
                                            <span class="material-symbols-rounded">analytics</span>
                                            Evaluate Fund
                                        </button>
                                    </div>

                                    <div id="fundEvaluationResults" class="evaluation-results"></div>
                                </div>
                            `;
                        }

                        function evaluateFund() {
                            const fundData = {
                                ticker: document.getElementById('fundTicker').value.toUpperCase(),
                                performance: {
                                    oneYear: parseFloat(document.getElementById('oneYearReturn').value),
                                    threeYear: parseFloat(document.getElementById('threeYearReturn').value),
                                    fiveYear: parseFloat(document.getElementById('fiveYearReturn').value),
                                    tenYear: parseFloat(document.getElementById('tenYearReturn').value)
                                },
                                expenses: parseFloat(document.getElementById('expenseRatio').value),
                                rating: parseInt(document.getElementById('morningstarRating').value),
                                risk: {
                                    standardDev: parseFloat(document.getElementById('standardDev').value),
                                    sharpeRatio: parseFloat(document.getElementById('sharpeRatio').value)
                                },
                                sustainability: {
                                    esgScore: parseInt(document.getElementById('esgScore').value),
                                    carbonRisk: parseInt(document.getElementById('carbonRisk').value)
                                }
                            };

                            // Calculate overall score
                            const scores = calculateFundScores(fundData);
                            displayFundEvaluation(scores, fundData);
                        }

                        function calculateFundScores(fundData) {
                            // Performance Score (0-100)
                            const performanceScore = 
                                (fundData.performance.oneYear * evaluationCriteria.performanceMetrics.oneYear.weight) +
                                (fundData.performance.threeYear * evaluationCriteria.performanceMetrics.threeYear.weight) +
                                (fundData.performance.fiveYear * evaluationCriteria.performanceMetrics.fiveYear.weight) +
                                (fundData.performance.tenYear * evaluationCriteria.performanceMetrics.tenYear.weight);

                            // Expense Score (0-100)
                            let expenseScore = 100;
                            if (fundData.expenses > evaluationCriteria.expenseRatio.poor) expenseScore = 25;
                            else if (fundData.expenses > evaluationCriteria.expenseRatio.fair) expenseScore = 50;
                            else if (fundData.expenses > evaluationCriteria.expenseRatio.good) expenseScore = 75;

                            // Risk Score (0-100)
                            const riskScore = (fundData.risk.sharpeRatio > 1 ? 100 : fundData.risk.sharpeRatio * 100);

                            // Sustainability Score (0-100)
                            const sustainabilityScore = 100 - fundData.sustainability.esgScore;

                            return {
                                performance: performanceScore,
                                expenses: expenseScore,
                                risk: riskScore,
                                sustainability: sustainabilityScore,
                                overall: (performanceScore * 0.4 + expenseScore * 0.3 + riskScore * 0.2 + sustainabilityScore * 0.1)
                            };
                        }

                        function displayFundEvaluation(scores, fundData) {
                            const resultsContainer = document.getElementById('fundEvaluationResults');
                            
                            resultsContainer.innerHTML = `
                                <div class="evaluation-summary">
                                    <h3>${fundData.ticker} Fund Evaluation</h3>
                                    
                                    <div class="overall-score">
                                        <div class="score-circle ${getScoreClass(scores.overall)}">
                                            <span class="score-number">${scores.overall.toFixed(1)}</span>
                                            <span class="score-label">Overall Score</span>
                                        </div>
                                    </div>

                                    <div class="score-breakdown">
                                        <div class="score-category">
                                            <h4>Performance</h4>
                                            <div class="score-bar">
                                                <div class="bar-fill" style="width: ${scores.performance}%"></div>
                                            </div>
                                            <span class="score-value">${scores.performance.toFixed(1)}</span>
                                        </div>

                                        <div class="score-category">
                                            <h4>Expenses</h4>
                                            <div class="score-bar">
                                                <div class="bar-fill" style="width: ${scores.expenses}%"></div>
                                            </div>
                                            <span class="score-value">${scores.expenses.toFixed(1)}</span>
                                        </div>

                                        <div class="score-category">
                                            <h4>Risk</h4>
                                            <div class="score-bar">
                                                <div class="bar-fill" style="width: ${scores.risk}%"></div>
                                            </div>
                                            <span class="score-value">${scores.risk.toFixed(1)}</span>
                                        </div>

                                        <div class="score-category">
                                            <h4>Sustainability</h4>
                                            <div class="score-bar">
                                                <div class="bar-fill" style="width: ${scores.sustainability}%"></div>
                                            </div>
                                            <span class="score-value">${scores.sustainability.toFixed(1)}</span>
                                        </div>
                                    </div>

                                    ${generateRecommendations(scores, fundData)}
                                </div>
                            `;
                        }
// Investment Recommendations Generator
                        function generateRecommendations(scores, fundData) {
                            let recommendations = '<div class="recommendations-section">';
                            recommendations += '<h4>Analysis & Recommendations</h4>';
                            
                            // Performance Analysis
                            recommendations += `
                                <div class="analysis-category">
                                    <h5>Performance Analysis</h5>
                                    <div class="analysis-content">
                                        ${generatePerformanceAnalysis(fundData.performance)}
                                    </div>
                                </div>
                            `;

                            // Cost Analysis
                            recommendations += `
                                <div class="analysis-category">
                                    <h5>Cost Analysis</h5>
                                    <div class="analysis-content">
                                        ${generateCostAnalysis(fundData.expenses)}
                                        ${generateCostImpactProjection(fundData.expenses)}
                                    </div>
                                </div>
                            `;

                            // Risk Assessment
                            recommendations += `
                                <div class="analysis-category">
                                    <h5>Risk Assessment</h5>
                                    <div class="analysis-content">
                                        ${generateRiskAnalysis(fundData.risk)}
                                    </div>
                                </div>
                            `;

                            // Alternatives Suggestion
                            if (scores.overall < 70) {
                                recommendations += `
                                    <div class="alternatives-section">
                                        <h5>Alternative Funds to Consider</h5>
                                        ${suggestAlternatives(fundData)}
                                    </div>
                                `;
                            }

                            recommendations += '</div>';
                            return recommendations;
                        }

                        function generatePerformanceAnalysis(performance) {
                            const benchmark = {
                                oneYear: 9.8,
                                threeYear: 10.2,
                                fiveYear: 11.5,
                                tenYear: 12.0
                            };

                            let analysis = '<div class="performance-comparison">';
                            analysis += '<table class="comparison-table">';
                            analysis += `
                                <tr>
                                    <th>Time Period</th>
                                    <th>Fund Return</th>
                                    <th>Benchmark</th>
                                    <th>Difference</th>
                                </tr>
                            `;

                            Object.entries(performance).forEach(([period, value]) => {
                                const benchmarkValue = benchmark[period];
                                const difference = value - benchmarkValue;
                                const differenceClass = difference >= 0 ? 'positive' : 'negative';

                                analysis += `
                                    <tr>
                                        <td>${formatPeriod(period)}</td>
                                        <td>${value.toFixed(2)}%</td>
                                        <td>${benchmarkValue.toFixed(2)}%</td>
                                        <td class="${differenceClass}">
                                            ${difference > 0 ? '+' : ''}${difference.toFixed(2)}%
                                        </td>
                                    </tr>
                                `;
                            });

                            analysis += '</table>';
                            analysis += generatePerformanceInsights(performance, benchmark);
                            analysis += '</div>';

                            return analysis;
                        }

                        function generateCostAnalysis(expenseRatio) {
                            const industryAvg = 0.57; // Industry average expense ratio
                            const lowCostThreshold = 0.20;
                            
                            let analysis = '<div class="cost-analysis">';
                            
                            // Cost comparison visualization
                            analysis += `
                                <div class="cost-comparison">
                                    <div class="cost-bar-container">
                                        <div class="cost-label">This Fund</div>
                                        <div class="cost-bar">
                                            <div class="bar-fill" style="width: ${(expenseRatio/1.5)*100}%">
                                                ${expenseRatio.toFixed(2)}%
                                            </div>
                                        </div>
                                    </div>
                                    <div class="cost-bar-container">
                                        <div class="cost-label">Industry Avg</div>
                                        <div class="cost-bar">
                                            <div class="bar-fill" style="width: ${(industryAvg/1.5)*100}%">
                                                ${industryAvg.toFixed(2)}%
                                            </div>
                                        </div>
                                    </div>
                                    <div class="cost-bar-container">
                                        <div class="cost-label">Low-Cost Target</div>
                                        <div class="cost-bar">
                                            <div class="bar-fill" style="width: ${(lowCostThreshold/1.5)*100}%">
                                                ${lowCostThreshold.toFixed(2)}%
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;

                            // Cost impact insights
                            analysis += `
                                <div class="cost-insights">
                                    <h6>Cost Impact Analysis</h6>
                                    <ul>
                                        ${expenseRatio > industryAvg ? 
                                            `<li class="warning">This fund's expenses are above industry average, which could significantly impact long-term returns.</li>` :
                                            `<li class="positive">This fund's expenses are below industry average, which is favorable for long-term returns.</li>`
                                        }
                                        <li>On a $10,000 investment, annual costs would be $${(expenseRatio * 100).toFixed(2)}</li>
                                        ${generateCostSavingsInsight(expenseRatio, industryAvg)}
                                    </ul>
                                </div>
                            `;

                            analysis += '</div>';
                            return analysis;
                        }

                        function generateCostImpactProjection(expenseRatio) {
                            const years = 30;
                            const initialInvestment = 10000;
                            const annualReturn = 0.07;

                            // Calculate growth with and without expenses
                            const withoutExpenses = initialInvestment * Math.pow(1 + annualReturn, years);
                            const withExpenses = initialInvestment * Math.pow(1 + (annualReturn - expenseRatio), years);
                            const costImpact = withoutExpenses - withExpenses;

                            return `
                                <div class="cost-impact-projection">
                                    <h6>30-Year Cost Impact Projection</h6>
                                    <div class="projection-details">
                                        <div class="projection-item">
                                            <span class="label">Without Expenses:</span>
                                            <span class="value">$${withoutExpenses.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</span>
                                        </div>
                                        <div class="projection-item">
                                            <span class="label">With Expenses:</span>
                                            <span class="value">$${withExpenses.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</span>
                                        </div>
                                        <div class="projection-item total-impact">
                                            <span class="label">Total Cost Impact:</span>
                                            <span class="value">$${costImpact.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }

                        function generateRiskAnalysis(riskMetrics) {
                            const standardDevBenchmark = 15.0; // Market standard deviation
                            const sharpeRatioBenchmark = 1.0; // Good Sharpe ratio threshold

                            let analysis = '<div class="risk-analysis">';
                            
                            // Risk metrics visualization
                            analysis += `
                                <div class="risk-metrics">
                                    <div class="metric-card">
                                        <h6>Volatility (Standard Deviation)</h6>
                                        <div class="metric-comparison">
                                            <div class="metric-value ${riskMetrics.standardDev <= standardDevBenchmark ? 'good' : 'warning'}">
                                                ${riskMetrics.standardDev.toFixed(2)}
                                            </div>
                                            <div class="benchmark">
                                                vs. Benchmark: ${standardDevBenchmark.toFixed(2)}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="metric-card">
                                        <h6>Risk-Adjusted Return (Sharpe Ratio)</h6>
                                        <div class="metric-comparison">
                                            <div class="metric-value ${riskMetrics.sharpeRatio >= sharpeRatioBenchmark ? 'good' : 'warning'}">
                                                ${riskMetrics.sharpeRatio.toFixed(2)}
                                            </div>
                                            <div class="benchmark">
                                                vs. Benchmark: ${sharpeRatioBenchmark.toFixed(2)}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;

                            // Risk assessment insights
                            analysis += `
                                <div class="risk-insights">
                                    <h6>Risk Assessment Insights</h6>
                                    <ul>
                                        ${generateRiskInsights(riskMetrics, standardDevBenchmark, sharpeRatioBenchmark)}
                                    </ul>
                                </div>
                            `;

                            analysis += '</div>';
                            return analysis;
                        }
// Interactive Learning Module
                        function initializeLearningModule() {
                            const learningTopics = {
                                compounding: {
                                    title: "Understanding Compound Interest",
                                    sections: [
                                        {
                                            title: "The Power of Time",
                                            content: createCompoundingDemo()
                                        },
                                        {
                                            title: "Rule of 72 Interactive",
                                            content: createRule72Interactive()
                                        }
                                    ]
                                },
                                marketBasics: {
                                    title: "Market Fundamentals",
                                    sections: [
                                        {
                                            title: "Bull vs Bear Markets",
                                            content: createMarketTypesDemo()
                                        },
                                        {
                                            title: "Market Indexes",
                                            content: createIndexComparison()
                                        }
                                    ]
                                },
                                riskManagement: {
                                    title: "Risk Management",
                                    sections: [
                                        {
                                            title: "Diversification Simulator",
                                            content: createDiversificationDemo()
                                        },
                                        {
                                            title: "Risk vs Return Interactive",
                                            content: createRiskReturnDemo()
                                        }
                                    ]
                                }
                            };

                            function createCompoundingDemo() {
                                return `
                                    <div class="interactive-demo">
                                        <div class="demo-controls">
                                            <div class="control-group">
                                                <label>Initial Investment ($)</label>
                                                <input type="range" id="initialAmount" 
                                                    min="1000" max="50000" step="1000" value="10000"
                                                    oninput="updateCompoundingDemo()">
                                                <span class="value-display">$10,000</span>
                                            </div>
                                            <div class="control-group">
                                                <label>Annual Return (%)</label>
                                                <input type="range" id="returnRate" 
                                                    min="1" max="15" step="0.5" value="7"
                                                    oninput="updateCompoundingDemo()">
                                                <span class="value-display">7%</span>
                                            </div>
                                            <div class="control-group">
                                                <label>Time Period (Years)</label>
                                                <input type="range" id="timePeriod" 
                                                    min="1" max="40" step="1" value="20"
                                                    oninput="updateCompoundingDemo()">
                                                <span class="value-display">20 years</span>
                                            </div>
                                            <div class="control-group">
                                                <label>Monthly Contribution ($)</label>
                                                <input type="range" id="monthlyContribution" 
                                                    min="0" max="1000" step="50" value="200"
                                                    oninput="updateCompoundingDemo()">
                                                <span class="value-display">$200</span>
                                            </div>
                                        </div>
                                        <div class="visualization-area">
                                            <canvas id="compoundingDemoChart"></canvas>
                                            <div id="compoundingInsights" class="insights-panel"></div>
                                        </div>
                                        <div class="key-takeaways">
                                            <h4>Key Learning Points</h4>
                                            <ul id="compoundingLessons"></ul>
                                        </div>
                                    </div>
                                `;
                            }

                            function createRule72Interactive() {
                                return `
                                    <div class="interactive-calculator">
                                        <div class="calculator-section">
                                            <h4>Rule of 72 Calculator</h4>
                                            <div class="input-group">
                                                <label>Enter Return Rate (%)</label>
                                                <input type="number" id="rule72Rate" value="6" 
                                                    min="0.1" max="20" step="0.1"
                                                    oninput="calculateRule72()">
                                            </div>
                                            <div id="rule72Result" class="result-display">
                                                <div class="years-to-double">12 years</div>
                                                <div class="explanation">
                                                    At 6% annual return, your money will double in approximately 12 years
                                                </div>
                                            </div>
                                        </div>
                                        <div class="comparison-table">
                                            <h4>Common Return Rates</h4>
                                            <table id="rule72Table">
                                                <tr>
                                                    <th>Return Rate</th>
                                                    <th>Years to Double</th>
                                                    <th>Investment Vehicle</th>
                                                </tr>
                                                <!-- Filled dynamically -->
                                            </table>
                                        </div>
                                    </div>
                                `;
                            }

                            function createMarketTypesDemo() {
                                return `
                                    <div class="market-types-simulator">
                                        <div class="market-scenario">
                                            <h4>Market Scenario Simulator</h4>
                                            <div class="scenario-controls">
                                                <button onclick="simulateBullMarket()">
                                                    <span class="material-symbols-rounded">trending_up</span>
                                                    Simulate Bull Market
                                                </button>
                                                <button onclick="simulateBearMarket()">
                                                    <span class="material-symbols-rounded">trending_down</span>
                                                    Simulate Bear Market
                                                </button>
                                                <button onclick="simulateVolatility()">
                                                    <span class="material-symbols-rounded">show_chart</span>
                                                    Add Volatility
                                                </button>
                                            </div>
                                            <div class="scenario-chart">
                                                <canvas id="marketScenarioChart"></canvas>
                                            </div>
                                        </div>
                                        <div class="market-characteristics">
                                            <div class="characteristic-card bull">
                                                <h5>Bull Market Characteristics</h5>
                                                <ul>
                                                    <li>Rising prices (20%+ from recent lows)</li>
                                                    <li>Increasing investor confidence</li>
                                                    <li>Strong economic indicators</li>
                                                    <li>Average duration: 2.7 years</li>
                                                </ul>
                                            </div>
                                            <div class="characteristic-card bear">
                                                <h5>Bear Market Characteristics</h5>
                                                <ul>
                                                    <li>Falling prices (20%+ from recent highs)</li>
                                                    <li>Declining investor confidence</li>
                                                    <li>Weak economic indicators</li>
                                                    <li>Average duration: 10 months</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }

                            function updateCompoundingDemo() {
                                const initial = parseFloat(document.getElementById('initialAmount').value);
                                const rate = parseFloat(document.getElementById('returnRate').value) / 100;
                                const years = parseInt(document.getElementById('timePeriod').value);
                                const monthly = parseFloat(document.getElementById('monthlyContribution').value);

                                // Update value displays
                                document.querySelectorAll('.control-group input').forEach(input => {
                                    const display = input.parentElement.querySelector('.value-display');
                                    if (input.id === 'returnRate') {
                                        display.textContent = input.value + '%';
                                    } else {
                                        display.textContent = '$' + parseInt(input.value).toLocaleString();
                                    }
                                });

                                // Calculate growth data
                                const data = calculateGrowthData(initial, rate, years, monthly);
                                
                                // Update chart
                                updateCompoundingChart(data);
                                
                                // Update insights
                                updateCompoundingInsights(data);
                            }
// Market Simulation Functions
                            function simulateBullMarket() {
                                const duration = 36; // 3 years in months
                                const baseReturn = 0.15; // 15% annual return
                                const data = generateMarketData(duration, baseReturn, 0.08);
                                updateMarketChart(data, 'Bull Market Simulation');
                                showMarketInsights('bull', data);
                            }

                            function simulateBearMarket() {
                                const duration = 12; // 1 year in months
                                const baseReturn = -0.25; // -25% annual return
                                const data = generateMarketData(duration, baseReturn, 0.12);
                                updateMarketChart(data, 'Bear Market Simulation');
                                showMarketInsights('bear', data);
                            }

                            function generateMarketData(duration, baseReturn, volatility) {
                                let data = [];
                                let value = 100; // Starting value
                                
                                for (let i = 0; i <= duration; i++) {
                                    // Add random volatility
                                    const monthlyReturn = (baseReturn / 12) + 
                                        (Math.random() - 0.5) * volatility;
                                    value *= (1 + monthlyReturn);
                                    
                                    data.push({
                                        month: i,
                                        value: value,
                                        return: monthlyReturn
                                    });
                                }
                                
                                return data;
                            }

                            function updateMarketChart(data, title) {
                                const ctx = document.getElementById('marketScenarioChart').getContext('2d');
                                
                                if (window.marketChart) {
                                    window.marketChart.destroy();
                                }

                                window.marketChart = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: data.map(d => `Month ${d.month}`),
                                        datasets: [{
                                            label: 'Market Value',
                                            data: data.map(d => d.value),
                                            borderColor: data[data.length-1].value > 100 ? 
                                                'rgb(20, 107, 58)' : 'rgb(186, 26, 26)',
                                            backgroundColor: data[data.length-1].value > 100 ?
                                                'rgba(20, 107, 58, 0.1)' : 'rgba(186, 26, 26, 0.1)',
                                            fill: true
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: {
                                            title: {
                                                display: true,
                                                text: title
                                            },
                                            tooltip: {
                                                callbacks: {
                                                    label: function(context) {
                                                        return `Value: ${context.raw.toFixed(2)}`;
                                                    }
                                                }
                                            }
                                        },
                                        scales: {
                                            y: {
                                                beginAtZero: false,
                                                title: {
                                                    display: true,
                                                    text: 'Index Value'
                                                }
                                            }
                                        }
                                    }
                                });
                            }

                            function showMarketInsights(type, data) {
                                const totalReturn = ((data[data.length-1].value / data[0].value) - 1) * 100;
                                const maxDrawdown = calculateMaxDrawdown(data);
                                const volatility = calculateVolatility(data);

                                const insightsContainer = document.getElementById('marketInsights');
                                insightsContainer.innerHTML = `
                                    <div class="market-insights ${type}">
                                        <h4>Market Analysis</h4>
                                        <div class="metrics-grid">
                                            <div class="metric">
                                                <label>Total Return</label>
                                                <value class="${totalReturn >= 0 ? 'positive' : 'negative'}">
                                                    ${totalReturn.toFixed(2)}%
                                                </value>
                                            </div>
                                            <div class="metric">
                                                <label>Max Drawdown</label>
                                                <value class="negative">
                                                    ${maxDrawdown.toFixed(2)}%
                                                </value>
                                            </div>
                                            <div class="metric">
                                                <label>Volatility</label>
                                                <value>${volatility.toFixed(2)}%</value>
                                            </div>
                                        </div>
                                        <div class="market-characteristics">
                                            <h5>Key Characteristics</h5>
                                            ${generateMarketCharacteristics(type, data)}
                                        </div>
                                        <div class="investor-guidance">
                                            <h5>Investor Guidance</h5>
                                            ${generateInvestorGuidance(type, data)}
                                        </div>
                                    </div>
                                `;
                            }

                            function calculateMaxDrawdown(data) {
                                let maxValue = data[0].value;
                                let maxDrawdown = 0;

                                for (let i = 1; i < data.length; i++) {
                                    if (data[i].value > maxValue) {
                                        maxValue = data[i].value;
                                    }
                                    
                                    const drawdown = ((maxValue - data[i].value) / maxValue) * 100;
                                    if (drawdown > maxDrawdown) {
                                        maxDrawdown = drawdown;
                                    }
                                }

                                return maxDrawdown;
                            }

                            function calculateVolatility(data) {
                                const returns = data.map(d => d.return);
                                const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
                                const variance = returns.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / returns.length;
                                return Math.sqrt(variance) * Math.sqrt(12) * 100; // Annualized volatility
                            }

                            function generateMarketCharacteristics(type, data) {
                                if (type === 'bull') {
                                    return `
                                        <ul class="characteristics-list">
                                            <li>Rising prices with positive momentum</li>
                                            <li>Higher trading volumes</li>
                                            <li>Increased investor confidence</li>
                                            <li>Economic expansion indicators</li>
                                        </ul>
                                    `;
                                } else {
                                    return `
                                        <ul class="characteristics-list">
                                            <li>Declining prices and negative sentiment</li>
                                            <li>Higher volatility</li>
                                            <li>Lower trading volumes</li>
                                            <li>Economic contraction indicators</li>
                                        </ul>
                                    `;
                                }
                            }

                            function generateInvestorGuidance(type, data) {
                                if (type === 'bull') {
                                    return `
                                        <div class="guidance-points">
                                            <div class="guidance-point">
                                                <span class="material-symbols-rounded">check_circle</span>
                                                <p>Maintain your regular investment schedule</p>
                                            </div>
                                            <div class="guidance-point">
                                                <span class="material-symbols-rounded">warning</span>
                                                <p>Don't get caught up in market euphoria</p>
                                            </div>
                                            <div class="guidance-point">
                                                <span class="material-symbols-rounded">balance</span>
                                                <p>Consider rebalancing if allocations drift</p>
                                            </div>
                                        </div>
                                    `;
                                } else {
                                    return `
                                        <div class="guidance-points">
                                            <div class="guidance-point">
                                                <span class="material-symbols-rounded">trending_down</span>
                                                <p>Stay invested - avoid panic selling</p>
                                            </div>
                                            <div class="guidance-point">
                                                <span class="material-symbols-rounded">shopping_cart</span>
                                                <p>Consider buying opportunities</p>
                                            </div>
                                            <div class="guidance-point">
                                                <span class="material-symbols-rounded">update</span>
                                                <p>Review and maintain your long-term strategy</p>
                                            </div>
                                        </div>
                                    `;
                                }
                            }
// Portfolio Diversification Simulator
                            function initializeDiversificationSimulator() {
                                const assetClasses = {
                                    'us-large-cap': {
                                        name: 'US Large Cap Stocks',
                                        avgReturn: 0.10,
                                        volatility: 0.15,
                                        correlation: {
                                            'us-large-cap': 1.0,
                                            'us-small-cap': 0.8,
                                            'international': 0.7,
                                            'bonds': 0.2,
                                            'real-estate': 0.5,
                                            'cash': 0.0
                                        }
                                    },
                                    'us-small-cap': {
                                        name: 'US Small Cap Stocks',
                                        avgReturn: 0.12,
                                        volatility: 0.18,
                                        correlation: {
                                            'us-large-cap': 0.8,
                                            'us-small-cap': 1.0,
                                            'international': 0.6,
                                            'bonds': 0.2,
                                            'real-estate': 0.5,
                                            'cash': 0.0
                                        }
                                    },
                                    'international': {
                                        name: 'International Stocks',
                                        avgReturn: 0.09,
                                        volatility: 0.17,
                                        correlation: {
                                            'us-large-cap': 0.7,
                                            'us-small-cap': 0.6,
                                            'international': 1.0,
                                            'bonds': 0.3,
                                            'real-estate': 0.4,
                                            'cash': 0.0
                                        }
                                    },
                                    'bonds': {
                                        name: 'Bonds',
                                        avgReturn: 0.04,
                                        volatility: 0.05,
                                        correlation: {
                                            'us-large-cap': 0.2,
                                            'us-small-cap': 0.2,
                                            'international': 0.3,
                                            'bonds': 1.0,
                                            'real-estate': 0.3,
                                            'cash': 0.2
                                        }
                                    },
                                    'real-estate': {
                                        name: 'Real Estate',
                                        avgReturn: 0.08,
                                        volatility: 0.16,
                                        correlation: {
                                            'us-large-cap': 0.5,
                                            'us-small-cap': 0.5,
                                            'international': 0.4,
                                            'bonds': 0.3,
                                            'real-estate': 1.0,
                                            'cash': 0.0
                                        }
                                    },
                                    'cash': {
                                        name: 'Cash',
                                        avgReturn: 0.01,
                                        volatility: 0.01,
                                        correlation: {
                                            'us-large-cap': 0.0,
                                            'us-small-cap': 0.0,
                                            'international': 0.0,
                                            'bonds': 0.2,
                                            'real-estate': 0.0,
                                            'cash': 1.0
                                        }
                                    }
                                };

                                function createDiversificationSimulator() {
                                    return `
                                        <div class="diversification-simulator">
                                            <div class="portfolio-builder">
                                                <h4>Build Your Portfolio</h4>
                                                <div class="asset-allocation-sliders">
                                                    ${Object.entries(assetClasses).map(([id, asset]) => `
                                                        <div class="allocation-slider">
                                                            <label>${asset.name}</label>
                                                            <input type="range" 
                                                                id="${id}-allocation" 
                                                                min="0" 
                                                                max="100" 
                                                                value="0" 
                                                                oninput="updateAllocation('${id}')"
                                                            >
                                                            <span class="allocation-value">0%</span>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                                <div class="allocation-summary">
                                                    <div class="total-allocation">
                                                        Total: <span id="total-allocation">0%</span>
                                                    </div>
                                                    <button class="button button--primary" 
                                                        onclick="analyzePortfolio()"
                                                        id="analyze-button" 
                                                        disabled
                                                    >
                                                        Analyze Portfolio
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="portfolio-analysis">
                                                <div class="analysis-charts">
                                                    <div class="chart-container">
                                                        <canvas id="portfolioCompositionChart"></canvas>
                                                    </div>
                                                    <div class="chart-container">
                                                        <canvas id="riskReturnChart"></canvas>
                                                    </div>
                                                </div>

                                                <div class="portfolio-metrics">
                                                    <div class="metric-card">
                                                        <h5>Expected Return</h5>
                                                        <div id="expected-return" class="metric-value"></div>
                                                    </div>
                                                    <div class="metric-card">
                                                        <h5>Portfolio Risk</h5>
                                                        <div id="portfolio-risk" class="metric-value"></div>
                                                    </div>
                                                    <div class="metric-card">
                                                        <h5>Sharpe Ratio</h5>
                                                        <div id="sharpe-ratio" class="metric-value"></div>
                                                    </div>
                                                </div>

                                                <div class="diversification-score">
                                                    <h5>Diversification Score</h5>
                                                    <div class="score-meter">
                                                        <div id="diversification-meter" class="meter-fill"></div>
                                                    </div>
                                                    <div id="diversification-feedback" class="feedback"></div>
                                                </div>
                                            </div>

                                            <div class="simulation-controls">
                                                <h4>Market Scenario Testing</h4>
                                                <div class="scenario-buttons">
                                                    <button onclick="simulateMarketScenario('bull')">
                                                        Bull Market
                                                    </button>
                                                    <button onclick="simulateMarketScenario('bear')">
                                                        Bear Market
                                                    </button>
                                                    <button onclick="simulateMarketScenario('recession')">
                                                        Recession
                                                    </button>
                                                    <button onclick="simulateMarketScenario('inflation')">
                                                        High Inflation
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }

                                function updateAllocation(assetId) {
                                    const allocations = calculateCurrentAllocations();
                                    const total = Object.values(allocations).reduce((a, b) => a + b, 0);
                                    
                                    document.getElementById('total-allocation').textContent = `${total}%`;
                                    document.getElementById('analyze-button').disabled = total !== 100;
                                    
                                    updateAllocationChart(allocations);
                                }

                                function calculateCurrentAllocations() {
                                    const allocations = {};
                                    Object.keys(assetClasses).forEach(id => {
                                        allocations[id] = parseInt(document.getElementById(`${id}-allocation`).value);
                                    });
                                    return allocations;
                                }
// Portfolio Analysis Functions
                                function analyzePortfolio() {
                                    const allocations = calculateCurrentAllocations();
                                    const analysis = calculatePortfolioMetrics(allocations);
                                    displayPortfolioAnalysis(analysis);
                                    generateRecommendations(analysis);
                                }

                                function calculatePortfolioMetrics(allocations) {
                                    // Calculate Expected Return
                                    let expectedReturn = 0;
                                    Object.entries(allocations).forEach(([assetId, allocation]) => {
                                        expectedReturn += (assetClasses[assetId].avgReturn * (allocation/100));
                                    });

                                    // Calculate Portfolio Risk (using correlation matrix)
                                    let portfolioRisk = 0;
                                    Object.entries(allocations).forEach(([asset1, alloc1]) => {
                                        Object.entries(allocations).forEach(([asset2, alloc2]) => {
                                            const correlation = assetClasses[asset1].correlation[asset2];
                                            const vol1 = assetClasses[asset1].volatility;
                                            const vol2 = assetClasses[asset2].volatility;
                                            
                                            portfolioRisk += (alloc1/100) * (alloc2/100) * correlation * vol1 * vol2;
                                        });
                                    });
                                    portfolioRisk = Math.sqrt(portfolioRisk);

                                    // Calculate Sharpe Ratio (assuming risk-free rate of 2%)
                                    const riskFreeRate = 0.02;
                                    const sharpeRatio = (expectedReturn - riskFreeRate) / portfolioRisk;

                                    // Calculate Diversification Score
                                    const divScore = calculateDiversificationScore(allocations);

                                    return {
                                        expectedReturn,
                                        portfolioRisk,
                                        sharpeRatio,
                                        diversificationScore: divScore,
                                        allocations
                                    };
                                }

                                function calculateDiversificationScore(allocations) {
                                    // Base score on concentration and correlation
                                    let concentrationPenalty = 0;
                                    let correlationPenalty = 0;
                                    
                                    // Penalize for high concentration in single assets
                                    Object.values(allocations).forEach(allocation => {
                                        if (allocation > 30) {
                                            concentrationPenalty += (allocation - 30) * 0.5;
                                        }
                                    });

                                    // Penalize for high correlation between major holdings
                                    Object.entries(allocations).forEach(([asset1, alloc1]) => {
                                        if (alloc1 > 10) {  // Only consider significant holdings
                                            Object.entries(allocations).forEach(([asset2, alloc2]) => {
                                                if (asset1 !== asset2 && alloc2 > 10) {
                                                    const correlation = assetClasses[asset1].correlation[asset2];
                                                    correlationPenalty += correlation * (alloc1/100) * (alloc2/100) * 20;
                                                }
                                            });
                                        }
                                    });

                                    // Calculate final score (100 is best)
                                    return Math.max(0, 100 - concentrationPenalty - correlationPenalty);
                                }

                                function displayPortfolioAnalysis(analysis) {
                                    // Update metrics display
                                    document.getElementById('expected-return').innerHTML = `
                                        ${(analysis.expectedReturn * 100).toFixed(2)}%
                                        <span class="metric-label">Annual</span>
                                    `;
                                    
                                    document.getElementById('portfolio-risk').innerHTML = `
                                        ${(analysis.portfolioRisk * 100).toFixed(2)}%
                                        <span class="metric-label">Volatility</span>
                                    `;
                                    
                                    document.getElementById('sharpe-ratio').innerHTML = `
                                        ${analysis.sharpeRatio.toFixed(2)}
                                        <span class="metric-label">Risk-Adjusted Return</span>
                                    `;

                                    // Update diversification meter
                                    const meter = document.getElementById('diversification-meter');
                                    meter.style.width = `${analysis.diversificationScore}%`;
                                    meter.className = `meter-fill ${getDiversificationClass(analysis.diversificationScore)}`;

                                    // Update feedback
                                    document.getElementById('diversification-feedback').innerHTML = 
                                        generateDiversificationFeedback(analysis);

                                    // Update charts
                                    updatePortfolioCharts(analysis);
                                }

                                function updatePortfolioCharts(analysis) {
                                    // Update Composition Pie Chart
                                    const compositionCtx = document.getElementById('portfolioCompositionChart').getContext('2d');
                                    if (window.compositionChart) {
                                        window.compositionChart.destroy();
                                    }

                                    window.compositionChart = new Chart(compositionCtx, {
                                        type: 'doughnut',
                                        data: {
                                            labels: Object.entries(analysis.allocations)
                                                .filter(([_, value]) => value > 0)
                                                .map(([key, _]) => assetClasses[key].name),
                                            datasets: [{
                                                data: Object.values(analysis.allocations)
                                                    .filter(value => value > 0),
                                                backgroundColor: [
                                                    '#146B3A', '#27856C', '#3A9E9E', 
                                                    '#4DB8D0', '#60D1FF', '#73EBFF'
                                                ]
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            maintainAspectRatio: false,
                                            plugins: {
                                                legend: {
                                                    position: 'right',
                                                    labels: {
                                                        generateLabels: (chart) => {
                                                            const data = chart.data;
                                                            return data.labels.map((label, i) => ({
                                                                text: `${label}: ${data.datasets[0].data[i]}%`,
                                                                fillStyle: data.datasets[0].backgroundColor[i]
                                                            }));
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    });

                                    // Update Risk/Return Scatter Plot
                                    createRiskReturnChart(analysis);
                                }

                                function createRiskReturnChart(analysis) {
                                    const riskReturnCtx = document.getElementById('riskReturnChart').getContext('2d');
                                    if (window.riskReturnChart) {
                                        window.riskReturnChart.destroy();
                                    }

                                    // Create data points for individual assets
                                    const assetPoints = Object.entries(assetClasses).map(([_, asset]) => ({
                                        x: asset.volatility * 100,
                                        y: asset.avgReturn * 100,
                                        label: asset.name
                                    }));

                                    window.riskReturnChart = new Chart(riskReturnCtx, {
                                        type: 'scatter',
                                        data: {
                                            datasets: [
                                                {
                                                    label: 'Asset Classes',
                                                    data: assetPoints,
                                                    backgroundColor: 'rgba(128, 128, 128, 0.5)'
                                                },
                                                {
                                                    label: 'Your Portfolio',
                                                    data: [{
                                                        x: analysis.portfolioRisk * 100,
                                                        y: analysis.expectedReturn * 100
                                                    }],
                                                    backgroundColor: 'rgba(20, 107, 58, 1)',
                                                    pointRadius: 10
                                                }
                                            ]
                                        },
                                        options: {
                                            responsive: true,
                                            maintainAspectRatio: false,
                                            scales: {
                                                x: {
                                                    title: {
                                                        display: true,
                                                        text: 'Risk (Volatility %)'
                                                    }
                                                },
                                                y: {
                                                    title: {
                                                        display: true,
                                                        text: 'Expected Return (%)'
                                                    }
                                                }
                                            },
                                            plugins: {
                                                tooltip: {
                                                    callbacks: {
                                                        label: function(context) {
                                                            const point = context.raw;
                                                            return point.label ? 
                                                                `${point.label}: Return: ${point.y.toFixed(1)}%, Risk: ${point.x.toFixed(1)}%` :
                                                                `Portfolio: Return: ${point.y.toFixed(1)}%, Risk: ${point.x.toFixed(1)}%`;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    });
                                }

// Market Scenario Simulation
                                function simulateMarketScenario(scenarioType) {
                                    const scenarios = {
                                        bull: {
                                            name: "Bull Market",
                                            duration: 24, // months
                                            modifiers: {
                                                'us-large-cap': { return: 0.20, volatility: 0.12 },
                                                'us-small-cap': { return: 0.25, volatility: 0.15 },
                                                'international': { return: 0.18, volatility: 0.14 },
                                                'bonds': { return: 0.03, volatility: 0.05 },
                                                'real-estate': { return: 0.15, volatility: 0.13 },
                                                'cash': { return: 0.02, volatility: 0.01 }
                                            }
                                        },
                                        bear: {
                                            name: "Bear Market",
                                            duration: 12,
                                            modifiers: {
                                                'us-large-cap': { return: -0.25, volatility: 0.25 },
                                                'us-small-cap': { return: -0.30, volatility: 0.30 },
                                                'international': { return: -0.28, volatility: 0.28 },
                                                'bonds': { return: 0.05, volatility: 0.08 },
                                                'real-estate': { return: -0.20, volatility: 0.22 },
                                                'cash': { return: 0.01, volatility: 0.01 }
                                            }
                                        },
                                        recession: {
                                            name: "Economic Recession",
                                            duration: 18,
                                            modifiers: {
                                                'us-large-cap': { return: -0.15, volatility: 0.22 },
                                                'us-small-cap': { return: -0.20, volatility: 0.28 },
                                                'international': { return: -0.18, volatility: 0.25 },
                                                'bonds': { return: 0.08, volatility: 0.06 },
                                                'real-estate': { return: -0.12, volatility: 0.20 },
                                                'cash': { return: 0.03, volatility: 0.01 }
                                            }
                                        },
                                        inflation: {
                                            name: "High Inflation",
                                            duration: 36,
                                            modifiers: {
                                                'us-large-cap': { return: 0.08, volatility: 0.18 },
                                                'us-small-cap': { return: 0.06, volatility: 0.22 },
                                                'international': { return: 0.10, volatility: 0.20 },
                                                'bonds': { return: -0.05, volatility: 0.12 },
                                                'real-estate': { return: 0.12, volatility: 0.15 },
                                                'cash': { return: -0.02, volatility: 0.02 }
                                            }
                                        }
                                    };

                                    const scenario = scenarios[scenarioType];
                                    const currentAllocations = calculateCurrentAllocations();
                                    
                                    // Run Monte Carlo simulation
                                    const simResults = runMonteCarloSimulation(
                                        currentAllocations, 
                                        scenario, 
                                        1000 // number of simulations
                                    );

                                    displayScenarioResults(simResults, scenario);
                                }

                                function runMonteCarloSimulation(allocations, scenario, iterations) {
                                    const results = [];
                                    const initialValue = 100000; // $100,000 starting portfolio

                                    for (let i = 0; i < iterations; i++) {
                                        let portfolioValue = initialValue;
                                        const monthlyValues = [portfolioValue];

                                        for (let month = 1; month <= scenario.duration; month++) {
                                            let monthlyReturn = 0;

                                            // Calculate monthly return based on allocations and scenario
                                            Object.entries(allocations).forEach(([assetId, allocation]) => {
                                                const modifier = scenario.modifiers[assetId];
                                                const monthlyMean = modifier.return / 12;
                                                const monthlyVol = modifier.volatility / Math.sqrt(12);
                                                
                                                // Generate random return using normal distribution
                                                const randomReturn = generateRandomNormal(monthlyMean, monthlyVol);
                                                monthlyReturn += (randomReturn * (allocation/100));
                                            });

                                            portfolioValue *= (1 + monthlyReturn);
                                            monthlyValues.push(portfolioValue);
                                        }

                                        results.push({
                                            finalValue: portfolioValue,
                                            monthlyValues: monthlyValues,
                                            totalReturn: (portfolioValue / initialValue - 1) * 100
                                        });
                                    }

                                    // Calculate statistics
                                    const stats = calculateSimulationStats(results);
                                    
                                    return {
                                        iterations: results,
                                        stats: stats
                                    };
                                }

                                function generateRandomNormal(mean, stdDev) {
                                    // Box-Muller transform
                                    let u1 = Math.random();
                                    let u2 = Math.random();
                                    
                                    let z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
                                    return z0 * stdDev + mean;
                                }

                                function calculateSimulationStats(results) {
                                    const returns = results.map(r => r.totalReturn);
                                    returns.sort((a, b) => a - b);

                                    return {
                                        median: returns[Math.floor(returns.length / 2)],
                                        worst5th: returns[Math.floor(returns.length * 0.05)],
                                        best5th: returns[Math.floor(returns.length * 0.95)],
                                        averageReturn: returns.reduce((a, b) => a + b, 0) / returns.length,
                                        volatility: Math.sqrt(
                                            returns.reduce((acc, val) => 
                                                acc + Math.pow(val - (returns.reduce((a, b) => a + b, 0) / returns.length), 2)
                                            , 0) / (returns.length - 1)
                                        )
                                    };
                                }

                                function displayScenarioResults(simResults, scenario) {
                                    // Create scenario results container
                                    const resultsContainer = document.createElement('div');
                                    resultsContainer.className = 'scenario-results';
                                    resultsContainer.innerHTML = `
                                        <h3>${scenario.name} Simulation Results</h3>
                                        <div class="simulation-stats">
                                            <div class="stat-card">
                                                <h4>Median Outcome</h4>
                                                <p class="value ${simResults.stats.median >= 0 ? 'positive' : 'negative'}">
                                                    ${simResults.stats.median.toFixed(2)}%
                                                </p>
                                            </div>
                                            <div class="stat-card">
                                                <h4>Worst Case (5th percentile)</h4>
                                                <p class="value negative">
                                                    ${simResults.stats.worst5th.toFixed(2)}%
                                                </p>
                                            </div>
                                            <div class="stat-card">
                                                <h4>Best Case (95th percentile)</h4>
                                                <p class="value positive">
                                                    ${simResults.stats.best5th.toFixed(2)}%
                                                </p>
                                            </div>
                                        </div>
                                        <div class="chart-container">
                                            <canvas id="scenarioSimulationChart"></canvas>
                                        </div>
                                        <div class="scenario-insights">
                                            ${generateScenarioInsights(simResults, scenario)}
                                        </div>
                                    `;

                                    // Replace or append results
                                    const existingResults = document.querySelector('.scenario-results');
                                    if (existingResults) {
                                        existingResults.replaceWith(resultsContainer);
                                    } else {
                                        document.querySelector('.portfolio-analysis').appendChild(resultsContainer);
                                    }

                                    // Create simulation paths chart
                                    createSimulationChart(simResults, scenario);
                                }

function createSimulationChart(simResults, scenario) {
                                    const ctx = document.getElementById('scenarioSimulationChart').getContext('2d');
                                    
                                    // Sample 50 random paths for visualization
                                    const pathsToShow = 50;
                                    const randomPaths = [];
                                    for (let i = 0; i < pathsToShow; i++) {
                                        const randomIndex = Math.floor(Math.random() * simResults.iterations.length);
                                        randomPaths.push(simResults.iterations[randomIndex].monthlyValues);
                                    }

                                    // Calculate median path
                                    const medianPath = calculateMedianPath(simResults.iterations);

                                    if (window.simulationChart) {
                                        window.simulationChart.destroy();
                                    }

                                    // Create datasets for each path
                                    const datasets = randomPaths.map((path, index) => ({
                                        data: path,
                                        borderColor: `rgba(128, 128, 128, 0.1)`,
                                        borderWidth: 1,
                                        fill: false,
                                        pointRadius: 0,
                                        showLine: true
                                    }));

                                    // Add median path
                                    datasets.push({
                                        data: medianPath,
                                        borderColor: 'rgb(20, 107, 58)',
                                        borderWidth: 3,
                                        fill: false,
                                        pointRadius: 0,
                                        showLine: true,
                                        label: 'Median Path'
                                    });

                                    window.simulationChart = new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                            labels: Array.from({length: scenario.duration + 1}, (_, i) => `Month ${i}`),
                                            datasets: datasets
                                        },
                                        options: {
                                            responsive: true,
                                            maintainAspectRatio: false,
                                            plugins: {
                                                title: {
                                                    display: true,
                                                    text: `Portfolio Value Simulation - ${scenario.name}`
                                                },
                                                tooltip: {
                                                    callbacks: {
                                                        label: function(context) {
                                                            return `$${context.raw.toLocaleString('en-US', {
                                                                minimumFractionDigits: 0,
                                                                maximumFractionDigits: 0
                                                            })}`;
                                                        }
                                                    }
                                                }
                                            },
                                            scales: {
                                                y: {
                                                    title: {
                                                        display: true,
                                                        text: 'Portfolio Value ($)'
                                                    },
                                                    ticks: {
                                                        callback: function(value) {
                                                            return '$' + value.toLocaleString('en-US', {
                                                                minimumFractionDigits: 0,
                                                                maximumFractionDigits: 0
                                                            });
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    });

                                    // Add confidence interval bands
                                    addConfidenceBands(simResults, scenario);
                                }

                                function calculateMedianPath(iterations) {
                                    const numMonths = iterations[0].monthlyValues.length;
                                    const medianPath = [];

                                    for (let month = 0; month < numMonths; month++) {
                                        const monthValues = iterations.map(iter => iter.monthlyValues[month]);
                                        monthValues.sort((a, b) => a - b);
                                        medianPath.push(monthValues[Math.floor(monthValues.length / 2)]);
                                    }

                                    return medianPath;
                                }

                                function addConfidenceBands(simResults, scenario) {
                                    const duration = scenario.duration + 1;
                                    const lowerBand = new Array(duration);
                                    const upperBand = new Array(duration);

                                    for (let month = 0; month < duration; month++) {
                                        const monthValues = simResults.iterations.map(iter => iter.monthlyValues[month]);
                                        monthValues.sort((a, b) => a - b);
                                        
                                        lowerBand[month] = monthValues[Math.floor(monthValues.length * 0.05)];
                                        upperBand[month] = monthValues[Math.floor(monthValues.length * 0.95)];
                                    }

                                    window.simulationChart.data.datasets.push({
                                        label: '90% Confidence Interval',
                                        data: upperBand,
                                        fill: '+1',
                                        backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                        borderWidth: 0,
                                        pointRadius: 0
                                    });

                                    window.simulationChart.data.datasets.push({
                                        data: lowerBand,
                                        fill: false,
                                        borderWidth: 0,
                                        pointRadius: 0
                                    });

                                    window.simulationChart.update();
                                }

                                function generateScenarioInsights(simResults, scenario) {
                                    const stats = simResults.stats;
                                    let insights = '<div class="scenario-insights-container">';
                                    
                                    // Risk Assessment
                                    insights += `
                                        <div class="insight-section risk-assessment">
                                            <h4>Risk Assessment</h4>
                                            <div class="risk-meter">
                                                <div class="risk-level" style="width: ${calculateRiskLevel(stats)}%"></div>
                                            </div>
                                            <p>${generateRiskDescription(stats, scenario)}</p>
                                        </div>
                                    `;

                                    // Asset Performance
                                    insights += `
                                        <div class="insight-section asset-performance">
                                            <h4>Asset Class Performance</h4>
                                            <div class="performance-grid">
                                                ${generateAssetPerformanceInsights(scenario)}
                                            </div>
                                        </div>
                                    `;

                                    // Recommendations
                                    insights += `
                                        <div class="insight-section recommendations">
                                            <h4>Portfolio Recommendations</h4>
                                            ${generateScenarioRecommendations(scenario, stats)}
                                        </div>
                                    `;

                                    insights += '</div>';
                                    return insights;
                                }

                                function calculateRiskLevel(stats) {
                                    // Convert statistics into a risk level percentage
                                    const volatilityFactor = Math.min(stats.volatility / 30 * 100, 100);
                                    const downsideFactor = Math.min(Math.abs(stats.worst5th) / 50 * 100, 100);
                                    return (volatilityFactor + downsideFactor) / 2;
                                }

function generateRiskDescription(stats, scenario) {
                                    const riskLevel = calculateRiskLevel(stats);
                                    const descriptions = {
                                        low: `Under this ${scenario.name} scenario, your portfolio shows relatively low risk. 
                              The worst-case outcome of ${stats.worst5th.toFixed(2)}% suggests good downside protection.`,
                                        moderate: `Your portfolio shows moderate risk exposure in this ${scenario.name} scenario. 
                                 While the median return of ${stats.median.toFixed(2)}% is favorable, 
                                 there's notable volatility to consider.`,
                                        high: `This portfolio shows higher sensitivity to ${scenario.name} conditions. 
                               The wide range between best and worst outcomes (${stats.best5th.toFixed(2)}% to 
                               ${stats.worst5th.toFixed(2)}%) indicates significant volatility.`
                                    };

                                    if (riskLevel < 40) return descriptions.low;
                                    if (riskLevel < 70) return descriptions.moderate;
                                    return descriptions.high;
                                }

                                function generateAssetPerformanceInsights(scenario) {
                                    let insights = '';
                                    Object.entries(scenario.modifiers).forEach(([assetId, modifier]) => {
                                        const performanceClass = modifier.return >= 0 ? 'positive' : 'negative';
                                        insights += `
                                            <div class="asset-insight">
                                                <h5>${assetClasses[assetId].name}</h5>
                                                <div class="performance-metrics">
                                                    <div class="metric ${performanceClass}">
                                                        <span class="label">Return:</span>
                                                        <span class="value">${(modifier.return * 100).toFixed(1)}%</span>
                                                    </div>
                                                    <div class="metric">
                                                        <span class="label">Volatility:</span>
                                                        <span class="value">${(modifier.volatility * 100).toFixed(1)}%</span>
                                                    </div>
                                                </div>
                                                <p class="insight-text">
                                                    ${generateAssetInsight(assetId, modifier, scenario)}
                                                </p>
                                            </div>
                                        `;
                                    });
                                    return insights;
                                }

                                function generateAssetInsight(assetId, modifier, scenario) {
                                    const performanceMap = {
                                        bull: {
                                            'us-large-cap': 'Large caps typically lead in bull markets with strong earnings growth.',
                                            'us-small-cap': 'Small caps often outperform during economic expansion phases.',
                                            'international': 'International markets benefit from global growth momentum.',
                                            'bonds': 'Bonds may underperform as rates typically rise in strong markets.',
                                            'real-estate': 'Real estate benefits from economic growth and low unemployment.',
                                            'cash': 'Cash positions offer stability but may lag in strong markets.'
                                        },
                                        bear: {
                                            'us-large-cap': 'Large caps often provide better downside protection.',
                                            'us-small-cap': 'Small caps typically face more pressure in market downturns.',
                                            'international': 'International markets may face increased volatility.',
                                            'bonds': 'Bonds often serve as a safe haven during market stress.',
                                            'real-estate': 'Real estate can face pressure from economic uncertainty.',
                                            'cash': 'Cash provides stability and dry powder for opportunities.'
                                        },
                                        recession: {
                                            'us-large-cap': 'Quality large caps often weather recessions better.',
                                            'us-small-cap': 'Small caps may struggle with tighter credit conditions.',
                                            'international': 'Global exposure can help diversify recession impact.',
                                            'bonds': 'Government bonds typically perform well in recessions.',
                                            'real-estate': 'Real estate may face pressure from reduced demand.',
                                            'cash': 'Cash provides important flexibility during uncertainty.'
                                        },
                                        inflation: {
                                            'us-large-cap': 'Companies with pricing power can better handle inflation.',
                                            'us-small-cap': 'Small caps may struggle with higher input costs.',
                                            'international': 'International exposure can help hedge currency risks.',
                                            'bonds': 'Bonds typically underperform during inflationary periods.',
                                            'real-estate': 'Real estate can serve as an inflation hedge.',
                                            'cash': 'Cash loses purchasing power during high inflation.'
                                        }
                                    };

                                    return performanceMap[scenario.name.toLowerCase().split(' ')[0]][assetId];
                                }

                                function generateScenarioRecommendations(scenario, stats) {
                                    let recommendations = '<ul class="recommendation-list">';
                                    
                                    // Generate scenario-specific recommendations
                                    const scenarioRecs = {
                                        bull: [
                                            "Consider maintaining or slightly increasing equity exposure",
                                            "Look for opportunities in growth sectors",
                                            "Monitor for signs of market overvaluation",
                                            "Keep some dry powder for potential corrections"
                                        ],
                                        bear: [
                                            "Review defensive positioning",
                                            "Consider increasing high-quality bonds",
                                            "Look for strategic rebalancing opportunities",
                                            "Maintain adequate emergency reserves"
                                        ],
                                        recession: [
                                            "Focus on quality and defensive sectors",
                                            "Consider increasing fixed income allocation",
                                            "Monitor for signs of economic recovery",
                                            "Look for opportunistic purchases in quality assets"
                                        ],
                                        inflation: [
                                            "Consider inflation-protected securities",
                                            "Look for companies with pricing power",
                                            "Review fixed income duration exposure",
                                            "Consider real asset allocation"
                                        ]
                                    };

                                    const scenarioType = scenario.name.toLowerCase().split(' ')[0];
                                    scenarioRecs[scenarioType].forEach(rec => {
                                        recommendations += `<li class="recommendation-item">${rec}</li>`;
                                    });

                                    // Add portfolio-specific recommendations based on statistics
                                    recommendations += generatePortfolioSpecificRecs(stats);

                                    recommendations += '</ul>';
                                    return recommendations;
                                }

function generatePortfolioSpecificRecs(stats) {
                                    let recommendations = '';

                                    // Risk-based recommendations
                                    if (stats.volatility > 0.20) {
                                        recommendations += `
                                            <li class="recommendation-item warning">
                                                <span class="material-symbols-rounded">warning</span>
                                                Consider reducing portfolio volatility through increased diversification
                                            </li>
                                        `;
                                    }

                                    // Downside protection recommendations
                                    if (stats.worst5th < -20) {
                                        recommendations += `
                                            <li class="recommendation-item warning">
                                                <span class="material-symbols-rounded">shield</span>
                                                Review downside protection strategies to limit potential losses
                                            </li>
                                        `;
                                    }

                                    // Return optimization recommendations
                                    if (stats.median < 5) {
                                        recommendations += `
                                            <li class="recommendation-item">
                                                <span class="material-symbols-rounded">trending_up</span>
                                                Consider optimizing return potential while maintaining risk tolerance
                                            </li>
                                        `;
                                    }

                                    return recommendations;
                                }

                                // Educational Content Generator
                                function createEducationalModule() {
                                    return `
                                        <div class="educational-module">
                                            <div class="module-tabs">
                                                <button class="tab-button active" onclick="showEducationalContent('basics')">
                                                    Investment Basics
                                                </button>
                                                <button class="tab-button" onclick="showEducationalContent('strategies')">
                                                    Investment Strategies
                                                </button>
                                                <button class="tab-button" onclick="showEducationalContent('analysis')">
                                                    Portfolio Analysis
                                                </button>
                                            </div>
                                            
                                            <div class="module-content" id="educational-content">
                                                ${generateBasicsContent()}
                                            </div>
                                        </div>
                                    `;
                                }

                                function generateBasicsContent() {
                                    return `
                                        <div class="education-section">
                                            <h3>Understanding Investment Fundamentals</h3>
                                            
                                            <div class="concept-card">
                                                <h4>Risk and Return Relationship</h4>
                                                <div class="interactive-diagram">
                                                    <canvas id="riskReturnDiagram"></canvas>
                                                </div>
                                                <div class="concept-explanation">
                                                    <p>Higher potential returns typically come with increased risk. 
                                                    Understanding this relationship is crucial for portfolio construction.</p>
                                                    <div class="key-points">
                                                        <h5>Key Points:</h5>
                                                        <ul>
                                                            <li>Lower risk generally means lower potential returns</li>
                                                            <li>Higher risk can lead to higher potential returns</li>
                                                            <li>Diversification helps optimize this relationship</li>
                                                        </ul>
                                                    </div>
                                                    <button class="button button--secondary" 
                                                        onclick="showInteractiveDemo('riskReturn')">
                                                        Try Interactive Demo
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="concept-card">
                                                <h4>Compound Interest</h4>
                                                <div class="interactive-diagram">
                                                    <canvas id="compoundingDiagram"></canvas>
                                                </div>
                                                <div class="concept-explanation">
                                                    <p>Compound interest is the exponential growth of your investments over time,
                                                    as you earn returns on both your initial investment and previous returns.</p>
                                                    <div class="formula-box">
                                                        <h5>The Power of Compounding</h5>
                                                        <p class="formula">A = P(1 + r)^t</p>
                                                        <p class="formula-explanation">
                                                            Where: A = Final amount, P = Principal, 
                                                            r = Annual rate, t = Time in years
                                                        </p>
                                                    </div>
                                                    <button class="button button--secondary" 
                                                        onclick="showInteractiveDemo('compound')">
                                                        Try Interactive Demo
                                                    </button>
                                                </div>
                                            </div>

                                            <div class="concept-card">
                                                <h4>Asset Allocation</h4>
                                                <div class="interactive-diagram">
                                                    <canvas id="allocationDiagram"></canvas>
                                                </div>
                                                <div class="concept-explanation">
                                                    <p>Asset allocation is the strategic division of your portfolio across different
                                                    investment types to balance risk and return potential.</p>
                                                    <div class="allocation-examples">
                                                        <h5>Common Allocations:</h5>
                                                        <div class="allocation-grid">
                                                            ${generateAllocationExamples()}
                                                        </div>
                                                    </div>
                                                    <button class="button button--secondary" 
                                                        onclick="showInteractiveDemo('allocation')">
                                                        Try Interactive Demo
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }

                                function generateAllocationExamples() {
                                    const examples = {
                                        conservative: {
                                            stocks: 30,
                                            bonds: 60,
                                            cash: 10
                                        },
                                        moderate: {
                                            stocks: 60,
                                            bonds: 35,
                                            cash: 5
                                        },
                                        aggressive: {
                                            stocks: 80,
                                            bonds: 15,
                                            cash: 5
                                        }
                                    };

                                    return Object.entries(examples).map(([type, allocation]) => `
                                        <div class="allocation-example">
                                            <h6>${type.charAt(0).toUpperCase() + type.slice(1)}</h6>
                                            <div class="allocation-bars">
                                                <div class="bar stocks" style="width: ${allocation.stocks}%">
                                                    ${allocation.stocks}% Stocks
                                                </div>
                                                <div class="bar bonds" style="width: ${allocation.bonds}%">
                                                    ${allocation.bonds}% Bonds
                                                </div>
                                                <div class="bar cash" style="width: ${allocation.cash}%">
                                                    ${allocation.cash}% Cash
                                                </div>
                                            </div>
                                        </div>
                                    `).join('');
                                }

// Index Comparison Tools
                                function createIndexComparisonTools() {
                                    return `
                                        <div class="index-comparison-tools">
                                            <div class="comparison-header">
                                                <h3>S&P 500 vs Small Cap Value Comparison</h3>
                                                <p class="subtitle">Based on Fama-French Research Data</p>
                                            </div>

                                            <div class="historical-comparison">
                                                <div class="time-range-selector">
                                                    <button class="time-button" onclick="updateTimeRange('10y')">10 Years</button>
                                                    <button class="time-button" onclick="updateTimeRange('20y')">20 Years</button>
                                                    <button class="time-button active" onclick="updateTimeRange('30y')">30 Years</button>
                                                    <button class="time-button" onclick="updateTimeRange('max')">Max (1926-Present)</button>
                                                </div>

                                                <div class="comparison-charts">
                                                    <div class="chart-container">
                                                        <h4>Growth of $10,000</h4>
                                                        <canvas id="growthComparisonChart"></canvas>
                                                    </div>
                                                    <div class="chart-container">
                                                        <h4>Rolling Returns Comparison</h4>
                                                        <canvas id="rollingReturnsChart"></canvas>
                                                    </div>
                                                </div>

                                                <div class="key-metrics-comparison">
                                                    <div class="metric-cards">
                                                        <div class="metric-card sp500">
                                                            <h4>S&P 500</h4>
                                                            <div class="metric">
                                                                <label>Annualized Return</label>
                                                                <div class="value" id="sp500Return"></div>
                                                            </div>
                                                            <div class="metric">
                                                                <label>Standard Deviation</label>
                                                                <div class="value" id="sp500Risk"></div>
                                                            </div>
                                                            <div class="metric">
                                                                <label>Sharpe Ratio</label>
                                                                <div class="value" id="sp500Sharpe"></div>
                                                            </div>
                                                            <div class="metric">
                                                                <label>Max Drawdown</label>
                                                                <div class="value" id="sp500Drawdown"></div>
                                                            </div>
                                                        </div>

                                                        <div class="metric-card small-cap">
                                                            <h4>Small Cap Value</h4>
                                                            <div class="metric">
                                                                <label>Annualized Return</label>
                                                                <div class="value" id="scvReturn"></div>
                                                            </div>
                                                            <div class="metric">
                                                                <label>Standard Deviation</label>
                                                                <div class="value" id="scvRisk"></div>
                                                            </div>
                                                            <div class="metric">
                                                                <label>Sharpe Ratio</label>
                                                                <div class="value" id="scvSharpe"></div>
                                                            </div>
                                                            <div class="metric">
                                                                <label>Max Drawdown</label>
                                                                <div class="value" id="scvDrawdown"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="research-insights">
                                                    <h4>Fama-French Research Insights</h4>
                                                    <div class="research-cards">
                                                        <div class="research-card">
                                                            <h5>Size Premium</h5>
                                                            <p>Small-cap stocks have historically outperformed large-cap stocks due to:</p>
                                                            <ul>
                                                                <li>Greater growth potential</li>
                                                                <li>Less analyst coverage creating opportunities</li>
                                                                <li>Higher risk premium demanded by investors</li>
                                                            </ul>
                                                        </div>

                                                        <div class="research-card">
                                                            <h5>Value Premium</h5>
                                                            <p>Value stocks have historically outperformed growth stocks due to:</p>
                                                            <ul>
                                                                <li>Higher risk perception</li>
                                                                <li>Behavioral biases favoring growth</li>
                                                                <li>Mean reversion in profitability</li>
                                                            </ul>
                                                        </div>

                                                        <div class="research-card">
                                                            <h5>Risk Considerations</h5>
                                                            <p>Key factors to consider with small cap value:</p>
                                                            <ul>
                                                                <li>Higher volatility</li>
                                                                <li>Lower liquidity</li>
                                                                <li>Longer recovery periods</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="interactive-scenarios">
                                                    <h4>Market Scenario Analysis</h4>
                                                    <div class="scenario-buttons">
                                                        <button onclick="simulateScenario('bull')">Bull Market</button>
                                                        <button onclick="simulateScenario('bear')">Bear Market</button>
                                                        <button onclick="simulateScenario('recession')">Recession</button>
                                                        <button onclick="simulateScenario('recovery')">Recovery</button>
                                                    </div>
                                                    <div class="scenario-results">
                                                        <canvas id="scenarioChart"></canvas>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }

                                // Initialize Index Comparison Tools
                                function initializeIndexComparison() {
                                    loadHistoricalData();
                                    setupCharts();
                                    updateMetrics();
                                }
// Historical Data Functions for Index Comparison
                                function loadHistoricalData() {
                                    // Historical data from Fama-French research
                                    const historicalData = {
                                        'sp500': {
                                            returns: generateHistoricalReturns('sp500'),
                                            volatility: generateHistoricalVolatility('sp500'),
                                            drawdowns: generateHistoricalDrawdowns('sp500')
                                        },
                                        'smallCapValue': {
                                            returns: generateHistoricalReturns('smallCapValue'),
                                            volatility: generateHistoricalVolatility('smallCapValue'),
                                            drawdowns: generateHistoricalDrawdowns('smallCapValue')
                                        }
                                    };

                                    return historicalData;
                                }

                                function generateHistoricalReturns(index) {
                                    const baseReturns = {
                                        'sp500': {
                                            mean: 0.098,  // 9.8% historical average
                                            stdDev: 0.15  // 15% standard deviation
                                        },
                                        'smallCapValue': {
                                            mean: 0.127,  // 12.7% historical average
                                            stdDev: 0.18  // 18% standard deviation
                                        }
                                    };

                                    const returns = [];
                                    const monthlyData = [];
                                    let cumulativeValue = 10000; // Starting with $10,000

                                    for (let year = 1926; year <= 2024; year++) {
                                        for (let month = 0; month < 12; month++) {
                                            const monthlyReturn = generateMonthlyReturn(
                                                baseReturns[index].mean,
                                                baseReturns[index].stdDev
                                            );
                                            
                                            cumulativeValue *= (1 + monthlyReturn);
                                            monthlyData.push({
                                                date: new Date(year, month),
                                                value: cumulativeValue,
                                                return: monthlyReturn
                                            });
                                        }
                                        
                                        const annualReturn = (cumulativeValue / 10000) ** (1 / (year - 1925)) - 1;
                                        returns.push({
                                            year: year,
                                            return: annualReturn,
                                            value: cumulativeValue
                                        });
                                    }

                                    return {
                                        annual: returns,
                                        monthly: monthlyData
                                    };
                                }

                                function generateMonthlyReturn(annualMean, annualStdDev) {
                                    const monthlyMean = annualMean / 12;
                                    const monthlyStdDev = annualStdDev / Math.sqrt(12);
                                    
                                    // Box-Muller transform for normal distribution
                                    const u1 = Math.random();
                                    const u2 = Math.random();
                                    const z = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
                                    
                                    return monthlyMean + (monthlyStdDev * z);
                                }

                                function generateHistoricalVolatility(index) {
                                    const data = [];
                                    const rollingWindow = 36; // 3-year rolling volatility

                                    const returns = historicalData[index].returns.monthly;
                                    for (let i = rollingWindow; i < returns.length; i++) {
                                        const windowReturns = returns.slice(i - rollingWindow, i);
                                        const volatility = calculateVolatility(windowReturns.map(r => r.return));
                                        data.push({
                                            date: returns[i].date,
                                            volatility: volatility
                                        });
                                    }

                                    return data;
                                }

                                function calculateVolatility(returns) {
                                    const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
                                    const squaredDiffs = returns.map(r => Math.pow(r - mean, 2));
                                    const variance = squaredDiffs.reduce((a, b) => a + b, 0) / returns.length;
                                    return Math.sqrt(variance * 12); // Annualized volatility
                                }

                                function generateHistoricalDrawdowns(index) {
                                    const data = [];
                                    const values = historicalData[index].returns.monthly;
                                    let peak = values[0].value;
                                    
                                    values.forEach((value, i) => {
                                        if (value.value > peak) {
                                            peak = value.value;
                                        }
                                        const drawdown = (value.value - peak) / peak;
                                        data.push({
                                            date: value.date,
                                            drawdown: drawdown
                                        });
                                    });

                                    return data;
                                }

                                // Chart Setup Functions
                                function setupCharts() {
                                    setupGrowthChart();
                                    setupRollingReturnsChart();
                                    setupVolatilityChart();
                                }

                                function setupGrowthChart() {
                                    const ctx = document.getElementById('growthComparisonChart').getContext('2d');
                                    
                                    const data = {
                                        labels: historicalData.sp500.returns.annual.map(d => d.year),
                                        datasets: [
                                            {
                                                label: 'S&P 500',
                                                data: historicalData.sp500.returns.annual.map(d => d.value),
                                                borderColor: 'rgb(20, 107, 58)',
                                                backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                                fill: true
                                            },
                                            {
                                                label: 'Small Cap Value',
                                                data: historicalData.smallCapValue.returns.annual.map(d => d.value),
                                                borderColor: 'rgb(77, 99, 86)',
                                                backgroundColor: 'rgba(77, 99, 86, 0.1)',
                                                fill: true
                                            }
                                        ]
                                    };

                                    const options = {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        scales: {
                                            y: {
                                                type: 'logarithmic',
                                                title: {
                                                    display: true,
                                                    text: 'Growth of $10,000 (Log Scale)'
                                                }
                                            }
                                        },
                                        plugins: {
                                            tooltip: {
                                                callbacks: {
                                                    label: function(context) {
                                                        return `${context.dataset.label}: $${context.raw.toLocaleString('en-US')}`;
                                                    }
                                                }
                                            }
                                        }
                                    };

                                    if (window.growthChart) {
                                        window.growthChart.destroy();
                                    }

                                    window.growthChart = new Chart(ctx, {
                                        type: 'line',
                                        data: data,
                                        options: options
                                    });
                                }

function setupRollingReturnsChart() {
                                    const ctx = document.getElementById('rollingReturnsChart').getContext('2d');
                                    const rollingPeriod = 60; // 5-year rolling returns
                                    
                                    // Calculate rolling returns
                                    const sp500Rolling = calculateRollingReturns(historicalData.sp500.returns.monthly, rollingPeriod);
                                    const scvRolling = calculateRollingReturns(historicalData.smallCapValue.returns.monthly, rollingPeriod);

                                    const data = {
                                        labels: sp500Rolling.map(d => d.date.getFullYear()),
                                        datasets: [
                                            {
                                                label: 'S&P 500 5-Year Rolling Returns',
                                                data: sp500Rolling.map(d => d.return * 100),
                                                borderColor: 'rgb(20, 107, 58)',
                                                backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                                fill: false
                                            },
                                            {
                                                label: 'Small Cap Value 5-Year Rolling Returns',
                                                data: scvRolling.map(d => d.return * 100),
                                                borderColor: 'rgb(77, 99, 86)',
                                                backgroundColor: 'rgba(77, 99, 86, 0.1)',
                                                fill: false
                                            }
                                        ]
                                    };

                                    const options = {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        scales: {
                                            y: {
                                                title: {
                                                    display: true,
                                                    text: 'Annualized Return (%)'
                                                }
                                            }
                                        }
                                    };

                                    if (window.rollingReturnsChart) {
                                        window.rollingReturnsChart.destroy();
                                    }

                                    window.rollingReturnsChart = new Chart(ctx, {
                                        type: 'line',
                                        data: data,
                                        options: options
                                    });
                                }

                                // Investment Mistakes Module
                                function createInvestmentMistakesModule() {
                                    return `
                                        <div class="investment-mistakes-module">
                                            <h2>Common Investment Mistakes to Avoid</h2>
                                            
                                            <div class="mistakes-grid">
                                                ${generateMistakeCards()}
                                            </div>

                                            <div class="interactive-lessons">
                                                <h3>Interactive Lessons</h3>
                                                <div class="lesson-cards">
                                                    ${generateInteractiveLessons()}
                                                </div>
                                            </div>

                                            <div class="cost-impact-calculator">
                                                <h3>Cost Impact Calculator</h3>
                                                <div class="calculator-container">
                                                    <div class="input-section">
                                                        <div class="input-group">
                                                            <label>Investment Amount ($)</label>
                                                            <input type="number" id="impactAmount" value="10000">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Investment Period (Years)</label>
                                                            <input type="number" id="impactYears" value="30">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Annual Return (%)</label>
                                                            <input type="number" id="impactReturn" value="8">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Expense Ratio (%)</label>
                                                            <input type="number" id="impactExpense" value="1" step="0.1">
                                                        </div>
                                                        <button onclick="calculateCostImpact()" class="button button--primary">
                                                            Calculate Impact
                                                        </button>
                                                    </div>
                                                    <div class="results-section">
                                                        <canvas id="costImpactChart"></canvas>
                                                        <div id="costImpactResults"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="market-timing-simulator">
                                                <h3>Market Timing Impact Simulator</h3>
                                                <div class="simulator-container">
                                                    <div class="control-section">
                                                        <div class="input-group">
                                                            <label>Initial Investment ($)</label>
                                                            <input type="number" id="timingAmount" value="10000">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Number of Best Days Missed</label>
                                                            <select id="missedDays">
                                                                <option value="5">5 Best Days</option>
                                                                <option value="10">10 Best Days</option>
                                                                <option value="20">20 Best Days</option>
                                                            </select>
                                                        </div>
                                                        <button onclick="simulateMarketTiming()" class="button button--primary">
                                                            Show Impact
                                                        </button>
                                                    </div>
                                                    <div class="simulation-results">
                                                        <canvas id="timingImpactChart"></canvas>
                                                        <div id="timingImpactResults"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }

                                function generateMistakeCards() {
                                    const mistakes = [
                                        {
                                            title: "Not Watching Expenses",
                                            icon: "money_off",
                                            description: "High fees and expenses can significantly reduce long-term returns",
                                            impact: "A 1% higher expense ratio can reduce your portfolio value by 20% over 30 years",
                                            solution: "Choose low-cost index funds and ETFs with expense ratios under 0.2%"
                                        },
                                        {
                                            title: "Chasing Performance",
                                            icon: "speed",
                                            description: "Investing in funds or sectors based solely on recent performance",
                                            impact: "Studies show that past performance doesn't predict future returns",
                                            solution: "Focus on long-term strategy and maintain consistent asset allocation"
                                        },
                                        {
                                            title: "Emotional Decision Making",
                                            icon: "mood_bad",
                                            description: "Making investment decisions based on fear or greed",
                                            impact: "Emotional trading often leads to buying high and selling low",
                                            solution: "Develop and stick to a written investment plan"
                                        }
                                    ];

                                    return mistakes.map(mistake => `
                                        <div class="mistake-card">
                                            <div class="mistake-header">
                                                <span class="material-symbols-rounded">${mistake.icon}</span>
                                                <h4>${mistake.title}</h4>
                                            </div>
                                            <div class="mistake-content">
                                                <p class="description">${mistake.description}</p>
                                                <div class="impact">
                                                    <h5>Impact</h5>
                                                    <p>${mistake.impact}</p>
                                                </div>
                                                <div class="solution">
                                                    <h5>Solution</h5>
                                                    <p>${mistake.solution}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('');
                                }
function generateInteractiveLessons() {
                                    const lessons = [
                                        {
                                            id: 'expenses',
                                            title: 'The Impact of Expenses',
                                            type: 'calculator',
                                            description: 'See how different expense ratios affect your returns over time',
                                            interactive: true
                                        },
                                        {
                                            id: 'timing',
                                            title: 'Market Timing Pitfalls',
                                            type: 'simulation',
                                            description: 'Discover why trying to time the market often fails',
                                            interactive: true
                                        },
                                        {
                                            id: 'diversification',
                                            title: 'Diversification Benefits',
                                            type: 'comparison',
                                            description: 'Learn why putting all your eggs in one basket is risky',
                                            interactive: true
                                        }
                                    ];

                                    return lessons.map(lesson => `
                                        <div class="lesson-card" data-lesson="${lesson.id}">
                                            <div class="lesson-header">
                                                <h4>${lesson.title}</h4>
                                                <span class="lesson-type">${lesson.type}</span>
                                            </div>
                                            <p class="lesson-description">${lesson.description}</p>
                                            <button onclick="startLesson('${lesson.id}')" class="button button--secondary">
                                                Start Lesson
                                            </button>
                                        </div>
                                    `).join('');
                                }

                                function startLesson(lessonId) {
                                    switch(lessonId) {
                                        case 'expenses':
                                            showExpensesLesson();
                                            break;
                                        case 'timing':
                                            showTimingLesson();
                                            break;
                                        case 'diversification':
                                            showDiversificationLesson();
                                            break;
                                    }
                                }

                                function showExpensesLesson() {
                                    const lessonContent = `
                                        <div class="lesson-module">
                                            <div class="lesson-content">
                                                <h3>Understanding Investment Expenses</h3>
                                                
                                                <div class="expense-types">
                                                    <div class="expense-type">
                                                        <h4>Expense Ratios</h4>
                                                        <p>Annual cost of managing a fund, expressed as a percentage</p>
                                                        <div class="example-box">
                                                            <h5>Example:</h5>
                                                            <ul>
                                                                <li>Index Fund: 0.03% - 0.20%</li>
                                                                <li>Active Fund: 0.50% - 2.00%</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="expense-type">
                                                        <h4>Transaction Costs</h4>
                                                        <p>Costs incurred when buying or selling investments</p>
                                                        <div class="example-box">
                                                            <h5>Includes:</h5>
                                                            <ul>
                                                                <li>Trading Commissions</li>
                                                                <li>Bid-Ask Spreads</li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <div class="expense-type">
                                                        <h4>Load Fees</h4>
                                                        <p>Sales charges on mutual funds</p>
                                                        <div class="example-box">
                                                            <h5>Types:</h5>
                                                            <ul>
                                                                <li>Front-End Load (A shares)</li>
                                                                <li>Back-End Load (B shares)</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="interactive-calculator">
                                                    <h4>Expense Impact Calculator</h4>
                                                    <div class="calculator-inputs">
                                                        <div class="input-group">
                                                            <label>Investment Amount ($)</label>
                                                            <input type="number" id="expenseAmount" value="100000">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Investment Period (Years)</label>
                                                            <input type="number" id="expensePeriod" value="30">
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Expected Annual Return (%)</label>
                                                            <input type="number" id="expectedReturn" value="8">
                                                        </div>
                                                        <div class="expense-comparison">
                                                            <div class="input-group">
                                                                <label>Low-Cost Fund Expense Ratio (%)</label>
                                                                <input type="number" id="lowExpense" value="0.04" step="0.01">
                                                            </div>
                                                            <div class="input-group">
                                                                <label>High-Cost Fund Expense Ratio (%)</label>
                                                                <input type="number" id="highExpense" value="1.00" step="0.01">
                                                            </div>
                                                        </div>
                                                        <button onclick="compareExpenses()" class="button button--primary">
                                                            Compare Expenses
                                                        </button>
                                                    </div>
                                                    <div id="expenseComparisonResults"></div>
                                                    <canvas id="expenseComparisonChart"></canvas>
                                                </div>

                                                <div class="key-takeaways">
                                                    <h4>Key Takeaways</h4>
                                                    <ul>
                                                        <li>Small differences in expenses compound significantly over time</li>
                                                        <li>Index funds typically offer the lowest expense ratios</li>
                                                        <li>Always compare expenses when choosing between similar funds</li>
                                                        <li>Avoid load fees - plenty of no-load funds are available</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    `;

                                    // Display lesson content
                                    const lessonContainer = document.createElement('div');
                                    lessonContainer.className = 'lesson-container active';
                                    lessonContainer.innerHTML = lessonContent;
                                    
                                    // Replace current content
                                    document.querySelector('.interactive-lessons').innerHTML = '';
                                    document.querySelector('.interactive-lessons').appendChild(lessonContainer);

                                    // Initialize the expense comparison calculator
                                    initializeExpenseCalculator();
                                }
function showTimingLesson() {
                                    const lessonContent = `
                                        <div class="lesson-module timing-lesson">
                                            <h3>The Pitfalls of Market Timing</h3>
                                            
                                            <div class="timing-study">
                                                <div class="study-header">
                                                    <h4>Missing the Best Days</h4>
                                                    <p>Research shows that missing just a few of the market's best days can dramatically impact returns</p>
                                                </div>

                                                <div class="interactive-simulator">
                                                    <div class="simulator-controls">
                                                        <div class="input-group">
                                                            <label>Investment Period</label>
                                                            <select id="timingPeriod">
                                                                <option value="20">20 Years (2000-2020)</option>
                                                                <option value="30">30 Years (1990-2020)</option>
                                                                <option value="40">40 Years (1980-2020)</option>
                                                            </select>
                                                        </div>
                                                        <div class="input-group">
                                                            <label>Initial Investment ($)</label>
                                                            <input type="number" id="timingInvestment" value="10000">
                                                        </div>
                                                        <div class="scenario-selector">
                                                            <button onclick="showTimingScenario('allDays')" class="scenario-button active">
                                                                Fully Invested
                                                            </button>
                                                            <button onclick="showTimingScenario('missBest10')" class="scenario-button">
                                                                Miss 10 Best Days
                                                            </button>
                                                            <button onclick="showTimingScenario('missBest20')" class="scenario-button">
                                                                Miss 20 Best Days
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <div class="timing-visualization">
                                                        <canvas id="timingImpactChart"></canvas>
                                                        <div id="timingStats" class="stats-panel"></div>
                                                    </div>
                                                </div>

                                                <div class="real-world-examples">
                                                    <h4>Historical Market Timing Attempts</h4>
                                                    <div class="example-cards">
                                                        <div class="example-card">
                                                            <h5>Dot-Com Bubble (2000)</h5>
                                                            <p>Investors who tried to time the market often sold too early or too late</p>
                                                            <button onclick="showHistoricalExample('dotcom')" class="button button--secondary">
                                                                See Example
                                                            </button>
                                                        </div>
                                                        <div class="example-card">
                                                            <h5>2008 Financial Crisis</h5>
                                                            <p>Many investors missed the recovery by staying out too long</p>
                                                            <button onclick="showHistoricalExample('crisis2008')" class="button button--secondary">
                                                                See Example
                                                            </button>
                                                        </div>
                                                        <div class="example-card">
                                                            <h5>COVID-19 Crash (2020)</h5>
                                                            <p>Rapid decline and recovery caught many market timers off guard</p>
                                                            <button onclick="showHistoricalExample('covid')" class="button button--secondary">
                                                                See Example
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="dollar-cost-averaging">
                                                    <h4>Better Alternative: Dollar-Cost Averaging</h4>
                                                    <div class="dca-simulator">
                                                        <div class="simulator-controls">
                                                            <div class="input-group">
                                                                <label>Monthly Investment ($)</label>
                                                                <input type="number" id="dcaAmount" value="500">
                                                            </div>
                                                            <div class="input-group">
                                                                <label>Investment Period (Years)</label>
                                                                <input type="number" id="dcaPeriod" value="10">
                                                            </div>
                                                            <div class="input-group">
                                                                <label>Market Volatility</label>
                                                                <select id="dcaVolatility">
                                                                    <option value="low">Low</option>
                                                                    <option value="medium" selected>Medium</option>
                                                                    <option value="high">High</option>
                                                                </select>
                                                            </div>
                                                            <button onclick="simulateDCA()" class="button button--primary">
                                                                Simulate DCA Strategy
                                                            </button>
                                                        </div>
                                                        <div class="dca-results">
                                                            <canvas id="dcaChart"></canvas>
                                                            <div id="dcaStats" class="stats-panel"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="key-lessons">
                                                    <h4>Key Lessons on Market Timing</h4>
                                                    <div class="lessons-grid">
                                                        <div class="lesson-point">
                                                            <span class="material-symbols-rounded">schedule</span>
                                                            <h5>Time In vs. Timing</h5>
                                                            <p>Success comes from time in the market, not timing the market</p>
                                                        </div>
                                                        <div class="lesson-point">
                                                            <span class="material-symbols-rounded">trending_up</span>
                                                            <h5>Best Days Clustering</h5>
                                                            <p>Best days often occur close to worst days - missing one risks missing both</p>
                                                        </div>
                                                        <div class="lesson-point">
                                                            <span class="material-symbols-rounded">account_balance</span>
                                                            <h5>Systematic Approach</h5>
                                                            <p>Dollar-cost averaging removes emotion and timing pressure</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `;

                                    // Display lesson content
                                    const lessonContainer = document.createElement('div');
                                    lessonContainer.className = 'lesson-container active';
                                    lessonContainer.innerHTML = lessonContent;
                                    
                                    // Replace current content and initialize charts
                                    document.querySelector('.interactive-lessons').innerHTML = '';
                                    document.querySelector('.interactive-lessons').appendChild(lessonContainer);
                                    
                                    // Initialize the timing impact simulator
                                    initializeTimingSimulator();
                                }
function initializeTimingSimulator() {
                                    // Initialize market data
                                    const marketData = generateHistoricalMarketData();
                                    
                                    // Set up initial chart
                                    setupTimingChart(marketData);
                                    
                                    // Add event listeners
                                    document.getElementById('timingPeriod').addEventListener('change', updateTimingSimulation);
                                    document.getElementById('timingInvestment').addEventListener('input', updateTimingSimulation);
                                }

                                function generateHistoricalMarketData() {
                                    return {
                                        sp500: {
                                            dates: [],
                                            values: [],
                                            bestDays: [
                                                { date: '2020-03-24', return: 9.38 },
                                                { date: '2008-10-13', return: 11.58 },
                                                { date: '2008-10-28', return: 10.79 },
                                                { date: '2009-03-23', return: 7.76 },
                                                { date: '2020-03-13', return: 9.29 }
                                            ],
                                            worstDays: [
                                                { date: '2020-03-16', return: -11.98 },
                                                { date: '2008-10-15', return: -9.03 },
                                                { date: '2008-12-01', return: -8.93 },
                                                { date: '2009-02-10', return: -7.87 },
                                                { date: '2020-03-12', return: -9.51 }
                                            ]
                                        }
                                    };
                                }

                                function setupTimingChart(marketData) {
                                    const ctx = document.getElementById('timingImpactChart').getContext('2d');
                                    
                                    if (window.timingChart) {
                                        window.timingChart.destroy();
                                    }

                                    window.timingChart = new Chart(ctx, {
                                        type: 'line',
                                        data: {
                                            labels: marketData.sp500.dates,
                                            datasets: [{
                                                label: 'Fully Invested',
                                                data: marketData.sp500.values,
                                                borderColor: 'rgb(20, 107, 58)',
                                                backgroundColor: 'rgba(20, 107, 58, 0.1)',
                                                fill: true
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            maintainAspectRatio: false,
                                            plugins: {
                                                tooltip: {
                                                    mode: 'index',
                                                    intersect: false,
                                                    callbacks: {
                                                        label: function(context) {
                                                            return `$${context.raw.toLocaleString('en-US')}`;
                                                        }
                                                    }
                                                },
                                                annotation: {
                                                    annotations: generateMarketEventAnnotations(marketData)
                                                }
                                            },
                                            scales: {
                                                y: {
                                                    title: {
                                                        display: true,
                                                        text: 'Portfolio Value ($)'
                                                    },
                                                    ticks: {
                                                        callback: function(value) {
                                                            return '$' + value.toLocaleString('en-US');
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    });
                                }

                                // Show Diversification Lesson
                                function showDiversificationLesson() {
                                    const lessonContent = `
                                        <div class="lesson-module diversification-lesson">
                                            <h3>Understanding Diversification</h3>
                                            
                                            <div class="correlation-explorer">
                                                <h4>Asset Correlation Explorer</h4>
                                                <div class="correlation-matrix">
                                                    <canvas id="correlationHeatmap"></canvas>
                                                </div>
                                                <div class="correlation-insights"></div>
                                            </div>

                                            <div class="portfolio-builder">
                                                <h4>Build Your Diversified Portfolio</h4>
                                                <div class="asset-allocator">
                                                    <div class="allocation-sliders">
                                                        <div class="allocation-slider">
                                                            <label>US Large Cap Stocks</label>
                                                            <input type="range" min="0" max="100" value="40" 
                                                                   class="allocation-input" data-asset="large-cap">
                                                            <span class="allocation-value">40%</span>
                                                        </div>
                                                        <div class="allocation-slider">
                                                            <label>US Small Cap Stocks</label>
                                                            <input type="range" min="0" max="100" value="10" 
                                                                   class="allocation-input" data-asset="small-cap">
                                                            <span class="allocation-value">10%</span>
                                                        </div>
                                                        <div class="allocation-slider">
                                                            <label>International Stocks</label>
                                                            <input type="range" min="0" max="100" value="20" 
                                                                   class="allocation-input" data-asset="international">
                                                            <span class="allocation-value">20%</span>
                                                        </div>
                                                        <div class="allocation-slider">
                                                            <label>Bonds</label>
                                                            <input type="range" min="0" max="100" value="25" 
                                                                   class="allocation-input" data-asset="bonds">
                                                            <span class="allocation-value">25%</span>
                                                        </div>
                                                        <div class="allocation-slider">
                                                            <label>Real Estate</label>
                                                            <input type="range" min="0" max="100" value="5" 
                                                                   class="allocation-input" data-asset="real-estate">
                                                            <span class="allocation-value">5%</span>
                                                        </div>
                                                    </div>
                                                    <div class="allocation-chart">
                                                        <canvas id="allocationPieChart"></canvas>
                                                    </div>
                                                </div>

                                                <div class="portfolio-analysis">
                                                    <h4>Portfolio Analysis</h4>
                                                    <div class="analysis-metrics">
                                                        <div class="metric-card">
                                                            <label>Expected Return</label>
                                                            <span id="expectedReturn" class="metric-value"></span>
                                                        </div>
                                                        <div class="metric-card">
                                                            <label>Risk Level</label>
                                                            <span id="riskLevel" class="metric-value"></span>
                                                        </div>
                                                        <div class="metric-card">
                                                            <label>Diversification Score</label>
                                                            <span id="divScore" class="metric-value"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="scenario-tester">
                                                <h4>Market Scenario Tester</h4>
                                                <div class="scenario-buttons">
                                                    <button onclick="testScenario('bull')">Bull Market</button>
                                                    <button onclick="testScenario('bear')">Bear Market</button>
                                                    <button onclick="testScenario('inflation')">High Inflation</button>
                                                    <button onclick="testScenario('recession')">Recession</button>
                                                </div>
                                                <div class="scenario-results">
                                                    <canvas id="scenarioChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    `;

                                    // Display lesson content
                                    const lessonContainer = document.createElement('div');
                                    lessonContainer.className = 'lesson-container active';
                                    lessonContainer.innerHTML = lessonContent;
                                    
                                    // Replace current content
                                    document.querySelector('.interactive-lessons').innerHTML = '';
                                    document.querySelector('.interactive-lessons').appendChild(lessonContainer);

                                    // Initialize diversification tools
                                    initializeDiversificationTools();
                                }

function initializeDiversificationTools() {
                                    setupCorrelationHeatmap();
                                    setupAllocationChart();
                                    initializeScenarioTester();
                                    addAllocationListeners();
                                }

                                function setupCorrelationHeatmap() {
                                    const correlationData = {
                                        labels: ['US Large Cap', 'US Small Cap', 'International', 'Bonds', 'Real Estate'],
                                        data: [
                                            [1.00, 0.80, 0.70, 0.20, 0.50],
                                            [0.80, 1.00, 0.60, 0.20, 0.50],
                                            [0.70, 0.60, 1.00, 0.30, 0.40],
                                            [0.20, 0.20, 0.30, 1.00, 0.30],
                                            [0.50, 0.50, 0.40, 0.30, 1.00]
                                        ]
                                    };

                                    const ctx = document.getElementById('correlationHeatmap').getContext('2d');
                                    
                                    if (window.correlationChart) {
                                        window.correlationChart.destroy();
                                    }

                                    window.correlationChart = new Chart(ctx, {
                                        type: 'matrix',
                                        data: {
                                            labels: correlationData.labels,
                                            datasets: [{
                                                data: correlationData.data.flatMap((row, i) => 
                                                    row.map((value, j) => ({
                                                        x: i,
                                                        y: j,
                                                        v: value
                                                    }))
                                                ),
                                                backgroundColor: function(context) {
                                                    const value = context.dataset.data[context.dataIndex].v;
                                                    const alpha = Math.abs(value);
                                                    return value > 0 
                                                        ? `rgba(20, 107, 58, ${alpha})`
                                                        : `rgba(186, 26, 26, ${alpha})`;
                                                }
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            maintainAspectRatio: false,
                                            plugins: {
                                                tooltip: {
                                                    callbacks: {
                                                        title: function(context) {
                                                            const data = context[0].dataset.data[context[0].dataIndex];
                                                            return `${correlationData.labels[data.x]} vs ${correlationData.labels[data.y]}`;
                                                        },
                                                        label: function(context) {
                                                            const value = context.dataset.data[context.dataIndex].v;
                                                            return `Correlation: ${value.toFixed(2)}`;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    });
                                }

                                // Account Setup Module
                                function createAccountSetupModule() {
                                    return `
                                        <div class="account-setup-module">
                                            <h3>Investment Account Setup Guide</h3>
                                            
                                            <div class="account-type-comparison">
                                                <h4>Choose Your Account Type</h4>
                                                <div class="account-cards">
                                                    <div class="account-card" onclick="showAccountDetails('traditional-ira')">
                                                        <h5>Traditional IRA</h5>
                                                        <ul class="features">
                                                            <li>Tax-deductible contributions</li>
                                                            <li>Tax-deferred growth</li>
                                                            <li>Required distributions at 73</li>
                                                            <li>2024 Limit: $7,000 ($8,000 if 50+)</li>
                                                        </ul>
                                                        <div class="best-for">
                                                            Best for: Those expecting lower tax rates in retirement
                                                        </div>
                                                    </div>

                                                    <div class="account-card" onclick="showAccountDetails('roth-ira')">
                                                        <h5>Roth IRA</h5>
                                                        <ul class="features">
                                                            <li>After-tax contributions</li>
                                                            <li>Tax-free growth</li>
                                                            <li>No required distributions</li>
                                                            <li>2024 Limit: $7,000 ($8,000 if 50+)</li>
                                                        </ul>
                                                        <div class="best-for">
                                                            Best for: Those expecting higher tax rates in retirement
                                                        </div>
                                                    </div>

                                                    <div class="account-card" onclick="showAccountDetails('brokerage')">
                                                        <h5>Taxable Brokerage</h5>
                                                        <ul class="features">
                                                            <li>No contribution limits</li>
                                                            <li>No withdrawal restrictions</li>
                                                            <li>Capital gains taxes apply</li>
                                                            <li>Maximum flexibility</li>
                                                        </ul>
                                                        <div class="best-for">
                                                            Best for: Additional investing after maxing retirement accounts
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="broker-comparison">
                                                <h4>Select a Broker</h4>
                                                <div class="comparison-table">
                                                    <table>
                                                        <thead>
                                                            <tr>
                                                                <th>Broker</th>
                                                                <th>Minimum Investment</th>
                                                                <th>Trading Fees</th>
                                                                <th>Index Fund Selection</th>
                                                                <th>Research Tools</th>
                                                                <th>Mobile App</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${generateBrokerComparison()}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>

                                            <div class="account-setup-wizard">
                                                <h4>Account Setup Wizard</h4>
                                                <div class="setup-steps">
                                                    ${generateSetupSteps()}
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }
function generateBrokerComparison() {
                                    const brokers = {
                                        fidelity: {
                                            name: "Fidelity",
                                            minimum: "$0",
                                            fees: "0",
                                            indexFunds: "Excellent",
                                            research: "Comprehensive",
                                            mobileApp: "5/5"
                                        },
                                        schwab: {
                                            name: "Charles Schwab",
                                            minimum: "$0",
                                            fees: "0",
                                            indexFunds: "Excellent",
                                            research: "Comprehensive",
                                            mobileApp: "4.8/5"
                                        },
                                        vanguard: {
                                            name: "Vanguard",
                                            minimum: "$3,000",
                                            fees: "0",
                                            indexFunds: "Excellent",
                                            research: "Good",
                                            mobileApp: "4.5/5"
                                        }
                                    };

                                    return Object.values(brokers).map(broker => `
                                        <tr>
                                            <td>${broker.name}</td>
                                            <td>${broker.minimum}</td>
                                            <td>$${broker.fees}</td>
                                            <td>${broker.indexFunds}</td>
                                            <td>${broker.research}</td>
                                            <td>${broker.mobileApp}</td>
                                        </tr>
                                    `).join('');
                                }

                                function generateSetupSteps() {
                                    const steps = [
                                        {
                                            title: "Choose Account Type",
                                            description: "Select between Traditional IRA, Roth IRA, or Brokerage account",
                                            action: "compareAccounts()"
                                        },
                                        {
                                            title: "Select Broker",
                                            description: "Compare brokers and choose the best fit for your needs",
                                            action: "compareBrokers()"
                                        },
                                        {
                                            title: "Gather Information",
                                            description: "Prepare required personal information and documentation",
                                            action: "showRequiredDocs()"
                                        },
                                        {
                                            title: "Open Account",
                                            description: "Complete the online application process",
                                            action: "startApplication()"
                                        },
                                        {
                                            title: "Fund Account",
                                            description: "Link bank account and make initial deposit",
                                            action: "setupFunding()"
                                        },
                                        {
                                            title: "Select Investments",
                                            description: "Choose appropriate index funds or ETFs",
                                            action: "selectInvestments()"
                                        }
                                    ];

                                    return steps.map((step, index) => `
                                        <div class="setup-step" onclick="${step.action}">
                                            <div class="step-number">${index + 1}</div>
                                            <div class="step-content">
                                                <h5>${step.title}</h5>
                                                <p>${step.description}</p>
                                            </div>
                                            <span class="material-symbols-rounded">arrow_forward</span>
                                        </div>
                                    `).join('');
                                }

                                // Final Quiz System
                                function createFinalQuiz() {
                                    const quizContent = `
                                        <div class="final-quiz">
                                            <h3>Investment Knowledge Assessment</h3>
                                            <div class="quiz-progress">
                                                <div class="progress-bar">
                                                    <div class="progress-fill"></div>
                                                </div>
                                                <span class="progress-text">Question <span id="currentQuestion">1</span> of ${quizQuestions.length}</span>
                                            </div>
                                            <div id="quizContainer" class="quiz-container"></div>
                                            <div class="quiz-controls">
                                                <button onclick="previousQuestion()" class="button button--secondary" id="prevButton" disabled>
                                                    Previous
                                                </button>
                                                <button onclick="nextQuestion()" class="button button--primary" id="nextButton">
                                                    Next
                                                </button>
                                            </div>
                                        </div>
                                    `;

                                    return quizContent;
                                }

                                // Initialize entire application
                                function initializeApp() {
                                    // Set up navigation
                                    setupNavigation();
                                    
                                    // Initialize first module
                                    showModule('compound-interest');
                                    
                                    // Add event listeners
                                    addGlobalEventListeners();
                                    
                                    // Initialize charts
                                    initializeCharts();
                                }

                                function addGlobalEventListeners() {
                                    // Input validation
                                    document.querySelectorAll('input[type="number"]').forEach(input => {
                                        input.addEventListener('input', validateNumericInput);
                                    });

                                    // Responsive design
                                    window.addEventListener('resize', handleResize);
                                }

                                function validateNumericInput(event) {
                                    const input = event.target;
                                    let value = input.value.replace(/[^\d.-]/g, '');
                                    
                                    if (input.hasAttribute('min')) {
                                        value = Math.max(value, parseFloat(input.getAttribute('min')));
                                    }
                                    
                                    if (input.hasAttribute('max')) {
                                        value = Math.min(value, parseFloat(input.getAttribute('max')));
                                    }
                                    
                                    input.value = value;
                                }

                                // Start the application
                                document.addEventListener('DOMContentLoaded', initializeApp);

                            </script>
                        </body>
                        </html>
             



